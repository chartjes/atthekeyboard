<!DOCTYPE html>
<html>
    <head>
        <title>Home &mdash; @TheKeyboard &mdash; The ramblings of a grumpy programmer</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/components/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
        <link href="/css/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="stylesheet" href="/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="@TheKeyboard activity feed" />
        <link href="https://vjs.zencdn.net/5.5.3/video-js.css" rel="stylesheet">
        <script src="https://vjs.zencdn.net/ie8/1.1.1/videojs-ie8.min.js"></script>
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
        </style>
    </head>
    <body>
        <header>
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="/">@TheKeyboard</a>
                        <div class="nav-collapse collapse">
                            <ul class="nav">
                                <li><a href="/blog">Posts Archive</a></li>
                                <li><a href="/about">About</a></li>
                                <li><a href="/atom.xml">RSS/Atom</a></li>
                            </ul>
                        </div><!--/.nav-collapse -->
                    </div>
                </div>
            </div>
        </header>
        <div class="mainContent container">
            <div class="row-fluid">
                <div class="span8">
                        <article>
        <header>
            <h2><a href="/2017/09/06/who-coaches-the-coaches/">Who Coaches The Coaches?</a></h2>
           <h3>September 6th, 2017</h3>
        </header>
        <div>
            <p>One of the things I have grown to enjoy over the years is mentoring
people. It has felt like a very natural extension of the many years I
have spend doing conference talks -- find people who are struggling to
learn a concept I am familiar with, and then guide them through solutions.
It's a very hands-on experience for me, and it provides me with an outlet
to keep my programming skills from completely atrophying.</p>

<p>Back in March I got an email from <a href="https://twitter.com/skoop">Stefan Koopmanschap</a> 
asking me if I was interested in participating in <a href="https://weca.mp">WeCamp</a> later
on in the year. After a quick check with <a href="https://twitter.com/internet_widow">She Who Must Be Obeyed</a>
flights were booked and plans were hatched.</p>

<p>WeCamp is a very unique experience. Code retreats, where you get a group of
programmers together in a somewhat-isolated environment to work on something,
are rare enough. I've participated in a few while at Mozilla, so I have a
firm understanding of the underlying principles. WeCamp spins that a little
differently by putting people on a <a href="http://suitcasemag.com/wp-content/uploads/2014/04/island-2.jpg">private island in the Netherlands</a> where they are actually camping (albeit with beds instead of
sleeping on the floor of the tent).</p>

<p>I've been camping before, but not in at least 20 years, but I didn't think
that would be a problem. Instead, there was the issue of what I was going
to be doing as a coach. I had an idea of what a coach <em>might</em> do, but not
sure exactly what would happen. Luckily, we had a Coach of Coaches in
<a href="https://twitter.com/phpcodemonkey">Jeremy Coates</a> to guide myself and the
other coaches (Steven de Vries, Michelangelo van Dam, Jeroen van der Gulik,
and Juliette Reinders Folmer) through what we should expect and how to handle
some rough situations (more on that later).</p>

<p>We were all assigned teams, the other campers showed up, and we got to work.
And despite what you might think, it was actually work for the coaches too.</p>

<p>In my role as a mentor, I am used to being very hands-on with folks -- after
all I am here to help and share what I know! But coaching is a very different
thing. You are expected to help but definitely not step in and do the work
for them.</p>

<p>My team did ask me lots of really good questions and I was happy to share
my thoughts on a whole bunch of topics. My answers also surprised some of the
team members because of a phenomenon I call "social media dissonance" and is
entirely 100% my fault.</p>

<p>As someone who has spent A LOT of time on social media building up a brand to
wrap my programming-related activities around, it's natural that people assume
what they see me do on Twitter is how I am 100% of the time. To be clear, I am
simply exaggerating certain traits of mine for fun and to build up a consistent
marketing message. But I am not my Twitter account - it is part of me but not
all of me. People see me, a very physically large white male with some very
strong opinions on things, and assume it's going to be confrontations and
yelling from the get go. That is not who I am, but that is the message I pushed
for many years. Anyone who meets me in person and interacts with me for more
than 30 seconds realizes what Twitter performance art is really about.</p>

<p>So when people asked me questions related to testing during the code retreat
they were surprised to find that I was not immediately bellowing at them to
write tests for everything. Look, playing the character on Twitter can be a lot
of fun, but at the end of the day I am a real person dealing with real situations.
One of those is what to do when you are prototyping things as part of a code
retreat. Tests are nice, but until you have decided exactly what you are doing
writing tests might be a distraction. Figure out your approach, your API, your
interfaces and <em>then</em> break out the TDD and build stuff.</p>

<p>For the most part I valued the experience -- helping people reach higher levels
of skill (technical or otherwise) was the goal. I watched for tension between
team members, I got them water and snacks, and I worked very very hard to stay
out of their way but be there when they needed something from me. But it wasn't
all good.</p>

<p>One of the campers on my team was not having a good time -- they were struggling
with a lot of personal and professional issues. In retrospect, the type of help
they were looking for was not going to be provided at WeCamp. A discussion happened
at one point where this camper expressed their frustration at some professional
setbacks and was determined to not accept any feedback that contradicted their
own opinion. I attempted to provide some calm, constructive feedback on better ways to
handle the emotional side of such setbacks, and it culminated in the camper storming
out of the yurt we were working in and leaving the team.</p>

<p>This was definitely not what I was expecting.</p>

<p>Luckily there was a good support system
in place both for our frustrated camper and our stunned coach. In the end, the camper
was given the freedom to work on other tasks and I just stayed out of the way as to
not run the risk of another inadvertent confrontation.</p>

<p>In the end, my team got their application up to Minimum Viable Product status,
integrated our lost camper back into the presentation, and I am very proud of the work
they done and left them a lot of new things to think about. There is also a commitment
for follow-up conversations in November to find out how they have been able to apply
their experiences at WeCamp to their lives (both personal and professional).</p>

<p>See, part of the purpose of WeCamp is to give people a chance to set some goals that
will push them out of their comfort zone. My team members got a chance to do some of
that -- some with more success than others. But they definitely embraced the idea
of "willful change" and that part alone made it worth it to me.</p>

<p>Despite the blow-up with the frustrated camper, I enjoyed the coaching experience and
would not hesitate to do it again. As for WeCamp itself...I am not sure that I would
get a lot out of it just as a participant. My goals are moving towards non-coding
territory and something like WeCamp is not a good venue for working through those.</p>

<p>If you're looking for a very unique experience and a chance to push some boundaries
as a coder, you should check out WeCamp and code retreats in general. They offer
some very unique experiences in an environment geared towards providing you with
the support needed to make the cost of failure almost zero.</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/2017/05/26/letting-emacs-into-your-grumpy-heart/">Letting Emacs into your grumpy heart</a></h2>
           <h3>May 26th, 2017</h3>
        </header>
        <div>
            <p>Yes, the rumours are true. Your grumpy blogger, a long-time and generally
satisfied <a href="https://vim.org">Vim</a> user has decided to embrace some fear,
turn on <a href="https://www.emacswiki.org/emacs/Evil">EVIL mode</a> and give Emacs
a fair evaluation.</p>

<p>To be truthful, I had used Emacs before. Back in 2002 I was using Linux as
my working environment and used it because the guy sitting next to me
(hi Kemo, wherever you are!) was using it and showed me the basics. All I
retained over the years was C-x C-f to load files and C-x C-c to quit.</p>

<p>Over the years I tried all sorts of editors -- <a href="https://www.eclipse.org/">Eclipse</a>,
<a href="http://jedit.org/">JEdit</a>, <a href="https://macromates.com/">TextMate</a>, <a href="https://www.sublimetext.com/">Sublime Text</a> --
before finally settling on Vim and builidng the request muscle memory along
with the proper superior attitude.</p>

<p>I also have used <a href="https://www.jetbrains.com/pycharm/">PyCharm</a> and <a href="https://www.jetbrains.com/phpstorm/">PhpStorm</a>
because sometimes you need an IDE to help you when you are learning new languages
beyond the beginner stage or dealing with a <a href="https://github.com/opencfp/opencfp">really complicated code base you let spin out of control</a>.
Right tool for the right job is a real thing, not just advice that developers
who are bitter you don't like the tool they think is "right" give.</p>

<p>Vim is a great modal editor -- really powerful, and has a ridiculous amount
of plugins that can extend Vim to make it even more useful. I've been able
to get quite productive with it. At the same time, I can also get frustrated
with how some stuff seemed really hard to get just right with plugins and
how weird <a href="http://learnvimscriptthehardway.stevelosh.com/">Vimscript</a> is.</p>

<p>All the while I would see Emacs stuff bubble up to the surface on Twitter or
YouTube would recommend that I watch a video about it. I came to realize that
Emacs is very powerful and can do pretty much everything that Vim can do.
Plus there is EVIL mode, which allows me to use Emacs with all the HJKL goodness
I have come to expect from Vim.</p>

<p>I thought it might be constructive for me to go over my .emacs file as it
currently stands and explain my choices. Honestly, it hasn't been that hard a
transition using Emacs at this point. Retraining my brain to remember new
key combinations is the harder part.</p>

<pre><code>;;; Code:
(package-initialize)

(setq package-archives '(("gnu" . "http://elpa.gnu.org/packages/")
                         ("marmalade" . "https://marmalade-repo.org/packages/")
             ("melpa-stable" . "https://stable.melpa.org/packages/")
                       ("melpa" . "http://melpa.org/packages/")))
</code></pre>

<p>All I am gonna say here is that Emacs packaging is interesting.</p>

<pre><code>;;; EVIL mode to help me transition from Vim to Emacs
(require 'evil)
(evil-mode 1)
</code></pre>

<p>EVIL mode is a really good Vim emulation mode for Emacs. It allows me to
use most of the keystrokes I am comfortable with to move around within
Emacs buffers.</p>

<pre><code>;;; Some general settings
(setq make-backup-files nil)
(define-coding-system-alias 'UTF-8 'utf-8)
(setq inhibit-startup-message t)
(set-language-environment 'utf-8)
(set-default-coding-systems 'utf-8)
(set-selection-coding-system 'utf-8)
(set-locale-environment "en.UTF-8")
(prefer-coding-system 'utf-8)
</code></pre>

<p>I took these from Some Random Person's Emacs Settings. Mostly it's to make
sure we do everything in UTF-8 and to not have my filesystem littered with
all sorts of back-up files.</p>

<pre><code>;;; Set up autocomplete
(require 'auto-complete-config)
(setq-default ac-sources (add-to-list 'ac-sources 'ac-source-dictionary))
(ac-config-default)
(global-auto-complete-mode t)
</code></pre>

<p>Autocompletition that works! Before you get all mad, I have used autocompletion
in Vim for a long time but sometimes it wouldn't quite work properly. I have found
Emacs autocomplete to be programming language sensitive, something I did not notice happening
in Vim.</p>

<pre><code>;;; YaSnippet
(yas-global-mode 1)
</code></pre>

<p><a href="https://www.emacswiki.org/emacs/Yasnippet">YASnippet</a> is an Emacs mode that allows
you to create language-specific templates to allow you to quickly generate code for
things like for loops or if-then statements.</p>

<pre><code>;;; PHP settings
(require 'php-mode)
(require 'php-auto-yasnippets)
(define-key php-mode-map (kbd "C-c C-y") 'yas/create-php-snippet)
(payas/ac-setup)
(setq php-auto-yasnippet-php-program "/Users/chartjes/.emacs.d/Create-PHP-YASnippet.php")
</code></pre>

<p>Still gotta do PHP work despite all my Python QA work! The PHP mode is pretty solid,
and I like being able to generate snippets for my work. Remember kids, we only have so
many keystrokes in our fingers.</p>

<pre><code>;;; Some file mappings
(add-to-list 'auto-mode-alist '("\\.md\\'" . markdown-mode))
(add-to-list 'auto-mode-alist '("\\.py\\'" . python-mode))
</code></pre>

<p>Just telling Emacs what file endings map to what languages. Some programming-language
modes can figure this out, Emacs wanted me to be specific about Markdown and Python</p>

<pre><code>;;; Modeline
(defvar sml/theme)
(setq sml/theme 'powerline)
(sml/setup)
</code></pre>

<p>If you're a Vim user who liked <a href="https://github.com/Lokaltog/vim-powerline">a cool status line</a>?
Check out <a href="https://github.com/Malabarba/smart-mode-line/">smart-mode-line</a></p>

<pre><code>;;; Flycheck
(require 'flycheck)
(global-flycheck-mode t)
(setq flycheck-phpcs-standard "psr2")
(add-to-list 'flycheck-disabled-checkers 'python-pylint)
(add-hook 'python-mode-hook #'flycheck-mode)
(add-hook 'python-mode-hook
      (lambda () (flycheck-select-checker 'python-flake8)))
(require 'flycheck-color-mode-line)
(eval-after-load "flycheck"
  '(add-hook 'flycheck-mode-hook 'flycheck-color-mode-line-mode))
</code></pre>

<p><a href="https://github.com/flycheck/flycheck">Flycheck</a> will do on-the-fly syntax checking
of your code. Just hook into the proper modes and you'll be good to go. Works great
with PHP code too.</p>

<pre><code>;;; JEDI autocompletion for Python
(add-hook 'python-mode-hook 'jedi:setup)
(defvar jedi:complete-on-dot)
(setq jedi:complete-on-dot t)
</code></pre>

<p><a href="https://github.com/davidhalter/jedi">JEDI</a> is a cool tool for doing Python-specific
static analysis and syntax checking for your Python code. Highly recommend it.</p>

<pre><code>;;; Mageit for Git
(require 'magit)
(global-set-key (kbd "C-x g") 'magit-status)
</code></pre>

<p>The only Emacs mode you will ever need to do work with Git</p>

<pre><code>;;; Elm-specific settings
(require 'elm-mode)
</code></pre>

<p>Maybe one day I can do Elm for money.</p>

<pre><code>;;; We will also need web mode stuff
(require 'web-mode)
(setq web-mode-ac-sources-alist
  '(("php" . (ac-source-yasnippet ac-source-php-auto-yasnippets))
    ("html" . (ac-source-emmet-html-aliases ac-source-emmet-html-snippets))
    ("css" . (ac-source-css-property ac-source-emmet-css-snippets))))
(add-hook 'web-mode-before-auto-complete-hooks
          '(lambda ()
             (let ((web-mode-cur-language
                    (web-mode-language-at-pos)))
               (if (string= web-mode-cur-language "php")
                   (yas-activate-extra-mode 'php-mode)
                 (yas-deactivate-extra-mode 'php-mode))
               (if (string= web-mode-cur-language "css")
                   (setq emmet-use-css-transform t)
                 (setq emmet-use-css-transform nil)))))
</code></pre>

<p><a href="http://web-mode.org/">Web mode</a> is intended to make working with web-centric
languages easier in that it can recoginze when you have HTML and CSS code
mixed in with your scripting language of choice, applying different syntax
highlighting and styling rules to them. Really neat stuff</p>

<pre><code>;;; Python settings
(require 'virtualenvwrapper)
(venv-initialize-interactive-shells)
(setq venv-location '("/Users/chartjes/Kinto/kinto-integration-tests/venv-kit"))
</code></pre>

<p>Did I mention that you can make Emacs aware of virtual Python environments?</p>

<pre><code>;;; Settings for Corral (surrounding text with stuff)
(global-set-key (kbd "M-9") 'corral-parentheses-backward)
(global-set-key (kbd "M-0") 'corral-parentheses-forward)
(global-set-key (kbd "M-[") 'corral-brackets-backward)
(global-set-key (kbd "M-]") 'corral-brackets-forward)
(global-set-key (kbd "M-{") 'corral-braces-backward)
(global-set-key (kbd "M-}") 'corral-braces-forward)
(global-set-key (kbd "M-\"") 'corral-double-quotes-forward)
</code></pre>

<p>I have relied heavily on <a href="https://github.com/tpope/vim-surround">surround.vim</a> in the past,
<a href="https://github.com/nivekuil/corral">Corral</a> seems to be a great solution to do the same thing in Emacs.</p>

<p>So there you have it! My early experiences with Emacs are good, I am slowly learning
new keystrokes to do new things and trying to get Emacs to intelligently help me be
a better developer.</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/2017/04/26/async-api-testing-in-python/">Async API testing in Python</a></h2>
           <h3>April 26th, 2017</h3>
        </header>
        <div>
            <p>I've started liking the idea of creating contract-style tests for the APIs
that power services at Mozilla. They are simply another line of defense
against regressions and the accidental release of new functionality. As
with all my work at Mozilla, it's being done in Python using <a href="https://docs.pytest.org/en/latest">pytest</a>
but thanks to some work from my co-worker <a href="https://twitter.com/tarek_ziade">Tarek</a>
I have some new tools at my disposal.</p>

<p>First, we've started making use of <a href="http://swagger.io">Swagger</a> to get 
the developers to document their APIs. There is a wide variety of tools
that work with Swagger API specs, but Tarek went a little further and
put together <a href="https://github.com/tarekziade/smwogger">Smwogger</a> to make
this type of testing even easier.</p>

<p>He describes it as "a smoke test tool for services described through Swagger"
while I describe it as "a way for me to quickly write contract tests against an
API spec". I'm pretty sure we're both right.</p>

<p>While you can use it as a CLI tool (the docs are geared towards that) he also
thoughtfully added support for me to use the library from inside pytest. The only
catch is that the tool uses <a href="https://docs.python.org/3/library/asyncio.html">asyncio</a>,
which is what Python 3 uses to support writing concurrent code.</p>

<p>I thought it would be way more difficult than it was but Tarek guided me through
the extreme basics of concurrent Python code and after that I was able to write
the tests I wanted. So here's some code for you to see:</p>

<pre><code class="python">import asyncio
import configparser
import pytest
from smwogger import API

from fxtesteng.helpers import aslist

@pytest.fixture(scope="module")
def conf():
    config = configparser.ConfigParser()
    config.read('manifest.ini')
    return config


@pytest.fixture(scope="module")
def event_loop():
    return asyncio.get_event_loop()


@pytest.fixture(scope="module")
def api(event_loop, conf, env):
    return API(conf.get(env, 'api_definition'), loop=event_loop)


@pytest.mark.asyncio
async def test_version(api):
    res = await api.__version__()
    data = await res.json()
    expected_fields = aslist(conf.get(env, 'version_fields'))

    # First, make sure that data only contains fields we expect
    for key in data:
        assert key in expected_fields

    # Then make the we only have the expected fields in the data
    for field in expected_fields:
        assert field in data


@pytest.mark.asyncio
async def test_heartbeat(api):
    res = await api.__heartbeat__()
    data = await res.json()
    expected_fields = aslist(conf.get(env, 'heartbeat_fields'))

    # First, make sure that data only contains fields we expect
    for key in data:
        assert key in expected_fields

    # Then make the we only have the expected fields in the data
    for field in expected_fields:
        assert field in data
</code></pre>

<p>I hope the code is clear (except for the async parts) but the idea is 
to use the API object from smwogger to make calls, using the ID's that
the developer has assigned to that API call. I then loop through the
expected fields for that call (they are stored in that manifest.ini file
mentioned in the <code>conf()</code> fixture) and make sure everything matches
our expectations.</p>

<p>The next bit of work I need to do is to use the Swagger spec some more
and check the fields the API returns against what is actually in the spec
instead of using pre-defined values in that manifest file. Making sure
the developers follow their own specs is part of regression testing too!</p>

        </div>
            </article>
    <nav>
        <a href="/page/5">Newer Posts</a><br />
        <a href="/page/7">Older Posts</a><br />
    </nav>
                </div>
                <div class="span4 sidebar">
                    <div class="well">
                        <h4>@TheKeyboard <small>The ramblings of a grumpy programmer</small></h4>
                    </div>
                    <div class="well sidebar-nav">
                        <section>
                            <h3>Find stuff</h3>
                            <script>
                              (function() {
                                var cx = '010269902375244482518:ddxhg1qhod4';
                                var gcse = document.createElement('script');
                                gcse.type = 'text/javascript';
                                gcse.async = true;
                                gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
                                    '//www.google.com/cse/cse.js?cx=' + cx;
                                var s = document.getElementsByTagName('script')[0];
                                s.parentNode.insertBefore(gcse, s);
                              })();
                            </script>
                            <gcse:searchbox-only></gcse:searchbox-only>
                        </section>
                        <section>
                            <h3>Contact me</h3>
                            <ul>
                                <li>Email me at chartjes@grumpy-learning.com</li>
                                <li>Find me on Twitter as <a href="https://twitter.com/grmpyprogrammer">@grmpyprogrammer</a></li>
                            </ul>
                        </section>
			<section>
				<h3>Sponsor me</h3>
				<p>If you like the work I do on <a href="https://github.com/opencfp/opencfp/">OpenCFP</a> you can become a
				sponsor via my <a href="https://github.com/sponsors/chartjes">GitHub sponsors</a> page. Your sponsorship
				allows me to spend more time on open source and less time writing books and training material.</p>
			</section>
                        <section>
                            <h3>Books</h3>
                            <ul>
				<li><a href="https://leanpub.com/grumpy-guide">The Grumpy Programmer's Guide To Testing PHP Applications (currently pre-ordering)</a></li>
                                <li><a href="https://leanpub.com/test-driven">Building Test-Driven Developers</a></li>
                                <li><a href="https://leanpub.com/minimumviabletests">Minimum Viable Tests</a></li>
                                <li><a href="https://leanpub.com/grumpy-phpunit">The Grumpy Programmer's PHPUnit Cookbook</a></li>
                            </ul>
                        </section>
                    </div>
                </div>
            </div>
        </div>
        <footer class="container">
            &copy; 2020 @TheKeyboard
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/components/jquery/jquery.min.js"><\/script>')</script>
        <script src="/components/bootstrap/js/bootstrap.min.js"></script>
                
                <script src="/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
