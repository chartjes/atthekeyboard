<!DOCTYPE html>
<html>
    <head>
        <title>Home &mdash; @TheKeyboard &mdash; The ramblings of a grumpy programmer</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/components/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
        <link href="/css/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="stylesheet" href="/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="@TheKeyboard activity feed" />
        <link href="https://vjs.zencdn.net/5.5.3/video-js.css" rel="stylesheet">
        <script src="https://vjs.zencdn.net/ie8/1.1.1/videojs-ie8.min.js"></script>
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
        </style>
    </head>
    <body>
        <header>
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="/">@TheKeyboard</a>
                        <div class="nav-collapse collapse">
                            <ul class="nav">
                                <li><a href="/blog">Posts Archive</a></li>
                                <li><a href="/about">About</a></li>
                                <li><a href="/atom.xml">RSS/Atom</a></li>
                            </ul>
                        </div><!--/.nav-collapse -->
                    </div>
                </div>
            </div>
        </header>
        <div class="mainContent container">
            <div class="row-fluid">
                <div class="span8">
                        <article>
        <header>
            <h2><a href="/2009/01/03/my-seven-things/">My Sevent Things</a></h2>
           <h3>January 3rd, 2009</h3>
        </header>
        <div>
            <p>Interesting meme running round on the net, mostly via Twitter, where you tag seven people, and those who get tagged are supposed to share seven things about themselves.  In turn, those seven people should tag seven other people, and so on, and so forth.  I was tagged by <a href="http://blog.phpdeveloper.org/?p=113">Chris Cornutt aka enygma</a>, the unstoppable force behind PHPDeveloper.org and <a href="http://joind.in">Joind.in</a>.  Just to slightly correct him, I didn't actually create the image on the <a href="http://www.printfection.com/atthekeyboard">Framework Apocalypse t-shirt</a>, I was smart enough to get someone to draw it for me.  Prepare yourself for seven things you might not know about me:
</p>

<ol>
<li><i>I got paid to write my first computer program when I was 12 or 13</i>.  My first computer was a Commodore VIC-20, which I got when I was 10 or 11.  My mother was teaching computers and math at a private school in Toronto, and they needed someone to do up a salary grid for the teachers' pay.  Written in Apple BASIC on an Apple IIGS, complete with user input AND verification of the data they entered.</li>
<li><i>Although I have a diploma in computer science from community college, I also have a diploma in civil engineering</i></li>.  When it was time to go to college, I listened to my father who told me there would always be work in construction.  When I graduated, the construction industry in the Toronto area went into it's worst slump in a long time.  I remember sending out almost 100 resumes (this is pre-internet days, so all by mail or fax), hearing back from 3 places and getting hired by 1.  After a summer of working for minimum wage and 60 hours a week, I decided to go back to school and study what I really enjoyed, which was computer programming.
<li><i>My wife and I met at work</i>.  We were both working at a small ISP, she in sales and me doing phone support.  I was totally oblivious that she was interested in me and until one of her co-workers pushed her into asking me out for dinner after work one day.  10+ years of marriage later, we have two little girls and enjoying watching them grow up.</li>
<li><i>My mom and sister blog</i>, making us a truly wired family.  My mother talks about all her experiences at her blog <a href="http://www.teachersatrisk.com">Teachers At Risk</a>.  My sister, a stay-at-home mom and frustrated writer, shares her progress on her novel over at <a href="http://www.lisahartjes.com">her blog</a>.</li>
<li><i>I used to own a comic book store</i>.  Back in the mid '90s, my sister and I started up a comic store at a strip mall around the corner from where we lived.  It lasted one year and we burned through all the money our father had given to us.  In the end, it was a totally bad location despite what we thought.  I worked Saturdays and Sundays in the store and there were days when nobody came in at all.</li>
<li><i>I learned German on Saturday mornings for seven years as a kid</i>.  My parents are both of German descent, and they sent my sister and I to German heritage school for many years.  My oldest daughter goes to the same school now, 20+ years later, at *her* insistence.  I understand German better than I speak it, and often just use it to yell at my cats.  But it's starting to come back despite all my best efforts to bury the trauma of never being able to watch Saturday morning cartoons.</li>
<li><i>I'm writing a book</i>.  Inspired by P?draic Brady's self-published book about <a href="http://http://www.survivethedeepend.com/">Zend Framework</a>, I've started working on what I believe is a much-needed subject:  a guide to converting legacy applications over to using the <a href="http://cakephp.org">CakePHP</a> framework.  I've already got the outline for the book done, the introduction is written and the first two chapters half-written as well.</li>
</ol>

<p>
So, who shall be my next victims?  I've tried to think of people whom others haven't talked about yet at all, and the list is pretty small. Although some of these people aren't really close friends, I think they are all the type of people you should all get to know better.
<ul>
<li><a href="http://debuggable.com">Felix Geisend?rfer</a>, CakePHP guru and co-owner of an awesome consultancy based out of Deutschland.</li>
<li><a href="http://jan.prima.de/">Jan Lehnard</a>, CouchDB evangelist and reluctant PHP coder (as far as I can tell).  Always super helpful when asked for help, and the master of the human helicopter presentation technique</li>
<li><a href="http://www.openkomodo.com/blogs/jeffg">Jeff Graham</a>, who works at Activestate and promotes Komodo, OpenKomodo and PHP as well.  I've met him at a few conferences, genuinely nice guy and he's Canadian on top of it.</li>
<li><a href="http://blog.derekmartin.ca">Derek Martin</a>, former co-worker at an adult dating web site and co-contributor of our Zend_Service_Audioscrobbler component for Zend Framework.</li>
<li><a href="http://funkatron.com">Ed Finkler</a>, the awesomely talented developer behind <a href="http://funkatron.com/spaz">Spaz</a>, a Twitter client written in Adobe Air.  I'll forgive him for using Code Igniter</li>
</ul>
</p>

<p>
Looks like mostly everyone else has already been tagged.  So spread the meme and the world know a little bit more about yourself.
</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/2008/12/30/converting-legacy-apps-to-cakephp-part-3/">Converting Legacy Apps to CakePHP, Part 3</a></h2>
           <h3>December 30th, 2008</h3>
        </header>
        <div>
            <p>I hope everyone has had a good holiday season this winter of 2008/2009.  Me, I took two weeks of consecutive vacation time for the first time since my youngest was born.  This has given me time to relax, enjoy time with my family and think about 2009.  Due to time constraints I have been forced to start the process of handing over the Side Project That Will Not End to another developer who can give it the attention that it deserves and needs.  If you are well versed in CakePHP 1.2 and are looking for a side project that will push your skills, contact me.  The client is anxious to get it done and are awesome to work with.
</p>

<p>
Anyway, onto other matters.  As you saw in parts 1 and 2, a bug part in having a successful transition from legacy app to CakePHP is having an environment that is well suited to the use of a framework.  Having laid out the groundwork for that switchover, it's time to talk about the part of a refactoring or porting that is most difficult:  separating your business logic from your display logic.
</p>

<p>
In a post on this site, I talked about the concept of "fat models and skinny controllers".  Having worked with frameworks professionally for almost two years now, I can say that I think I can update that motto to be "fat models, skinny controllers, and flexible views".   So, just what do I mean about this.
</p>

<p>
The main reason people use a framework (other than to become a raving fanboi) is to provide structure to an application.  However, with this structure there comes some limitations.   Maybe limitations is the wrong word.  I prefer to borrow a term used a lot by the Rails world (and the Cake world as well), and that is "convention".  Every framework has it's conventions, and the culture and environment of the framework dictates what the rules are for the models, views and controllers.  Or models, views and templates if you're into Django.  Whatever you call them (data source, request responder, output?) any framework does its best to try and prevent you from doing harm to yourself while coding.
</p>

<p>
In what I call spaghetti PHP, you usually end up with applications that have their data source interactions, request responder and output mashed together.  The vast majority of my early code was of this type.  Nothing wrong with it, as long as it was cleanly written and easy to understand.  Frameworks say that this kind of thing leads to poorly written code and lack of flexibility.  Refactoring spaghetti PHP is not always easy, especially when you have to add new things into the mix.
</p>

<p>
So, as a result, it has become a common programming practice to make the effort to separate your business logic from your presentation logic.  I don't think this is a bad thing at all, framework fanboi that I am or not.  The goal in all this is to create an application that is easier to maintain going forward, and I truly believe that this can only be done through this separation.  But *how* do you do this?
</p>

<p>
Let's look at the first part of the new motto:  "fat models".  Now, I'm not talking about <a href="http:://http://en.wikipedia.org/wiki/Big_Beautiful_Woman">BBW</a> here, despite how many people end up on my site via a search along those lines.  The "fat model" is the concept of placing as much code in the data source interaction parts of your application as possible.  In Cake terms, this means creating methods in your models to do all the data crunching that you need, and then having your controllers simply call these model methods and pass the results to the view.
</p>

<p>
So, in our legacy app we had a structure that used "modules", which are really nothing more than a number of <a href="http://en.wikipedia.org/wiki/Front_controller">front controllers</a> that had request response processing via large switch-case blocks that did a lot of database calls.  Then, it would do a search-and-replace of tokens within a template based on the data retrieved and then display it.  While I had some issues with their "all-inclusive templates" that controlled the display of data via CSS calls that set "display:none" as needed, it did mean I had templates to work with.  
</p>

<p>
The next logical step then was to take a look at all the database calls that were being done within these modules and map them to a particular Cake model.  As I looked at the queries and what was being done with the results, I started breaking them done into one of two categories:
<ol>
<li>Results that could be obtained with the existing model methods like find('all') etc</li>
<li>Results that would require further manipulation of the data after using an existing model method call</li>
</ol>
</p>

<p>
Initially, I thought that I would be looking at a small number of the first category, but in the end it was the power of Cake's Associative Data Mapping capabilities that made me realize the number of custom model methods would be minimal.  Let me give you some examples.
</p>

<p>
Let's say that I need to get a list of all cases that belong to a particular firm.  Here's one way of doing that in Cake.
~~~
<?php

// Given that we have a has-and-belongs-to-many relationship 
// established between LegalCase and Firm, and the ID of the firm 
// already stored in the session via the Auth component

$conditions = array(
     'LegalCase.archived' => 0,
     'Firm.id' => $this->Auth->user('firm_id')
);
$order = 'LegalCase.case_name';
$cases = $this->LegalCase->CaseFirm->find('all', compact('conditions', 'order'));

?>
~~~
</p>

<p>
Very straightforward, and Cake would return to me an associative array containing all the cases that belong to the firm, ready to pass to the view.  If you were to look at the SQL generated by such a thing, you would see that it was using some SQL JOINS to link the cases, firms and cases_firms table to get my results.  I cannot recommend enough for people building things in CakePHP to use the awesome <a href="http://github.com/cakephp/debug_kit/tree/master">Debug Kit</a> to peer inside Cake as you develop.
</p>

<p>
In another part of the application, I had to get a list of orders that had been archived, count them, and group them by month.  Obviously this could not be done with just the existing model methods.  So I looked at the queries and then the code that followed those queries, then condensed them down into a method in the Order model:<br />
~~~
    function archivedOrdersCount($user_id) {
        $fields = "DATE_FORMAT(date_completed, '%m') as month_completed, DATE_FORMAT(date_completed, '%M') as month_name, DATE_FORMAT(date_completed, '%Y') as year_completed";
        $conditions = array(
            'user_id' => $user_id,
            'OR' => array(
                'client_archive' => 1,
                'void' => 1)
        );
        $order = "year_completed, month_completed ASC";
        $results = $this->find('all', compact('fields', 'conditions', 'order'));
        $orders = array();

        foreach ($results as $result) {
            $key = "{$result[0]['month_name']} {$result[0]['year_completed']}";
            
            if (!isset($orders[$key])) {
                $orders[$key] = array(
                    'year' => $result[0]['year_completed'],
                    'month' => $result[0]['month_completed'],
                    'label' => $key,
                    'count' => 0
                );
            }

            $orders[$key]['count']++;
        }   
        
        return $orders; 
    }
~~~
</p>

<p>
I think part of the problem a lot of people are faced with when converting a legacy app over to using *any* framework, is the idea that your problems are unique and not solvable via a framework.  In the context of using Cake's models, I think people would be really shocked to discover just how easy it really is now to take an existing query and make it work with Cake models.
</p>

<p>
I hope I've given you a little glimpse into some of the work involved in converting SQL calls in PHP over to using Cake's model objects.  In the next post in this series, I'll be showing what I mean by "skinny controllers".
</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/2008/12/27/cakephp-12-final-released-and-some-thoughts-on-frameworks/">CakePHP 1.2 Final released and some thoughts on frameworks</a></h2>
           <h3>December 27th, 2008</h3>
        </header>
        <div>
            <p>Congrats to the CakePHP dev team for getting 1.2 final out the door just in time for X-Mas.  Read all the details <a href="http://bakery.cakephp.org/articles/view/the-gift-of-1-2-final">here</a>.  I feel somewhat guilty as I have not been able to contribute to 1.2 during the run-up to the final release, but working with it for a side project has been enjoyable and living on the bleeding edge for a side project has not resulted in any show-stopping bugs.  That alone is worth mentioning.
</p>

<p>
I know that frameworks get a bad rap, especially full-stack ones like Cake, but most of those complaints come from people who are unwilling or unable to embrace the constraints on your environment that Cake places.  I used to be militant about that sort of thing, but I've come to realize that it just doesn't matter.  I'd rather shape my application to leverage the strengths of a framework.   Maybe I am just smart enough to figure out workarounds for the weaknesses.  But understanding the environment 
</p>

<p>
Terry Chay had an awesome contribution to PHP Advent 2008 where he talked about <a href="http://phpadvent.org/2008/php-without-php-by-terry-chay">some funky tricks in PHP and the importance of respecting the environment your code will run in.</a>.  After I said nice things about the post on Twitter, he sent this to me (note, this was spread across two tweets):
<blockquote>
<i>Thank you. I appreciate the comment. Happy Christmas. :-)  I know we don't always agree on things like CakePHP, so the fact that you liked the entry means a lot.</i>
</blockquote>
</p>

<p>
I was disappointed there were no f-bombs in the reply, but it's still nice to have someone you consider on another upper level of competency from you to say nice things back.</p>

<p>
Anyway, even if you hate CakePHP I think it's worth investing 5 to 10 minutes of your time to look at the announcement and see just how much stuff is in the 1.2 release and ask yourself how much of that code could you write yourself *and* have it be reusable by others.  To me, the fact that I can use much of what is in CakePHP without any modification beyond the conventions is the real reason to use it.
</p>

        </div>
            </article>
    <nav>
        <a href="/page/72">Newer Posts</a><br />
        <a href="/page/74">Older Posts</a><br />
    </nav>
                </div>
                <div class="span4 sidebar">
                    <div class="well">
                        <h4>@TheKeyboard <small>The ramblings of a grumpy programmer</small></h4>
                    </div>
                    <div class="well sidebar-nav">
                        <section>
                            <h3>Find stuff</h3>
                            <script>
                              (function() {
                                var cx = '010269902375244482518:ddxhg1qhod4';
                                var gcse = document.createElement('script');
                                gcse.type = 'text/javascript';
                                gcse.async = true;
                                gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
                                    '//www.google.com/cse/cse.js?cx=' + cx;
                                var s = document.getElementsByTagName('script')[0];
                                s.parentNode.insertBefore(gcse, s);
                              })();
                            </script>
                            <gcse:searchbox-only></gcse:searchbox-only>
                        </section>
                        <section>
                            <h3>Contact me</h3>
                            <ul>
                                <li>Email me at chartjes@grumpy-learning.com</li>
                                <li>Find me on Twitter as <a href="https://twitter.com/grmpyprogrammer">@grmpyprogrammer</a></li>
                            </ul>
                        </section>
			<section>
				<h3>Sponsor me</h3>
				<p>If you like the work I do on <a href="https://github.com/opencfp/opencfp/">OpenCFP</a> you can become a
				sponsor via my <a href="https://github.com/sponsors/chartjes">GitHub sponsors</a> page. Your sponsorship
				allows me to spend more time on open source and less time writing books and training material.</p>
			</section>
                        <section>
                            <h3>Books</h3>
                            <ul>
				<li><a href="https://leanpub.com/grumpy-guide">The Grumpy Programmer's Guide To Testing PHP Applications (currently pre-ordering)</a></li>
                                <li><a href="https://leanpub.com/test-driven">Building Test-Driven Developers</a></li>
                                <li><a href="https://leanpub.com/minimumviabletests">Minimum Viable Tests</a></li>
                                <li><a href="https://leanpub.com/grumpy-phpunit">The Grumpy Programmer's PHPUnit Cookbook</a></li>
                            </ul>
                        </section>
                    </div>
                </div>
            </div>
        </div>
        <footer class="container">
            &copy; 2020 @TheKeyboard
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/components/jquery/jquery.min.js"><\/script>')</script>
        <script src="/components/bootstrap/js/bootstrap.min.js"></script>
                
                <script src="/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
