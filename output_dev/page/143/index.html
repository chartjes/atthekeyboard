<!DOCTYPE html>
<html>
    <head>
        <title>Home &mdash; @TheKeyboard &mdash; The ramblings of a grumpy programmer</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/components/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
        <link href="/css/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="stylesheet" href="/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="@TheKeyboard activity feed" />
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
        </style>
    </head>
    <body>
        <header>
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="/">@TheKeyboard</a>
                        <div class="nav-collapse collapse">
                            <ul class="nav">
                                <li><a href="/blog">Posts Archive</a></li>
                                <li><a href="/blog/categories">Categories</a></li>
                                <li><a href="/blog/tags">Tags</a></li>
                                <li><a href="/about">About</a></li>
                            </ul>
                        </div><!--/.nav-collapse -->
                    </div>
                </div>
            </div>
        </header>
        <div class="mainContent container">
            <div class="row-fluid">
                <div class="span8">
                        <article>
        <header>
            <h2><a href="/blog/2013/04/30/testing-smells-try-catch">Testing Smells - try/catch</a></h2>
        </header>
        <div>
            <p>As part of a project to migrate the PHP code at <a href="http://synacor.com">work</a>
from PHP 5.2 to PHP 5.4, I'm using our extensive test suite to look for instances
where something that changed between the versions of PHP that we are using
has caused some unexpected behaviour.</p>

<p>In one of our code bases, I found some tests that are exhibiting a test smell
through their use of a try / catch block in the test itself.</p>

<p>Here's a totally-contrived example:</p>

<pre><code>    &lt;?php
    public function testThatExceptionIsThrown()
    {
        // Use a helper to give us a ready-to-go parser
        $parseHelper = $this-&gt;getHelper('parseHelper');

        /**
         * If we pass a string as the first parameter to parseGrumpyRambling
         * instead of an array, we should get an exception generated because
         * we are using a type hint
         */
        try {
            $weirdCanadianWords = '';
            $phrase = "No doot aboot it, we're gonna win at hockey!";
            $parsedText = $parseHelper-&gt;parseGrumpyRambling(
                $weirdCanadianWords,
                $phrase
            );
            $this-&gt;fail();
        } catch (Exception $e) {
            $this-&gt;assertContains(
                'must be of the type array, string given',
                $e-&gt;getMessage()
            );
        }
    }
</code></pre>

<p>Okay, so why does this test offend me so much?</p>

<p>First, I am of the opinion that writing a test to check to make sure you are
enforcing type hinting for your class method parameters is probably not a
good use of your time. I mean, what potential problem are you catching?</p>

<p>Consider the following:</p>

<ul>
<li>you likely have access to info about what type of value each parameter
is expected to be</li>
<li>you are probably much better off filtering for parameter type before you
even call that method</li>
</ul>

<p>I can say with confidence that a test like this is returning very little
value for the effort.</p>

<p>Second, putting any logic inside your unit tests is a great way to end
up with unexpected results. Need an "if" statement? Write two tests
for that condition. Need a switch / case? Again, one test per case is a
much better way to logically divide things up.</p>

<p>The worst thing about using try / catch is that <em>PHPUnit gives you two built-in
methods to not ever have to use it</em>. I've had people say to me "but Chris,
if you use try / catch you get much better control over determining where
in the process to test that the exception was thrown." I don't buy it, and
I will try and explain why.</p>

<p>If you are using docblocks on your tests (which you should) it is super easy
to indicate what exception you are expecting to be thrown.</p>

<pre><code>    &lt;?php
    /**
     * @expectedException Exception
     * @expectedExceptionMessage must be of the type array 
     */
    public function testThatExceptionIsThrown()
    {
        // Use a helper to give us a ready-to-go parser
        $parseHelper = $this-&gt;getHelper('parseHelper');

        /**
         * If we pass a string as the first parameter to parseGrumpyRambling
         * instead of an array, we should get an exception generated because
         * we are using a type hint
         */
        $weirdCanadianWords = '';
        $phrase = "No doot aboot it, we're gonna win at hockey!";
        $parsedText = $parseHelper-&gt;parseGrumpyRambling(
            $weirdCanadianWords,
            $phrase
        );
    }
</code></pre>

<p>Now we have a much cleaner-looking test with no conditional logic inside it.</p>

<p>You can also choose to use a built in PHPUnit method to set what exception
you are expecting.</p>

<pre><code>    &lt;?php
    public function testThatExceptionIsThrown()
    {
        $this-&gt;setExpectedException(
            'Exception',
            'must be of the type array'
        );

        // Use a helper to give us a ready-to-go parser
        $parseHelper = $this-&gt;getHelper('parseHelper');

        /**
         * If we pass a string as the first parameter to parseGrumpyRambling
         * instead of an array, we should get an exception generated because
         * we are using a type hint
         */
        $weirdCanadianWords = '';
        $phrase = "No doot aboot it, we're gonna win at hockey!";
        $parsedText = $parseHelper-&gt;parseGrumpyRambling(
            $weirdCanadianWords,
            $phrase
        );
    }
</code></pre>

<p>Again, a much cleaner-looking test with no conditional logic in sight.</p>

<p>On Twitter Brian Fenton shared a <a href="http://www.brianfenton.us/2011/09/bad-practice-setting-expected.html">blog post</a>
he wrote back in 2011 that disagrees with me. In it he very briefly talks about
why you should use try / catch in your tests, but I feel like he is contradicting
himself when he talks about why.</p>

<p>Basically, Brian is concerned about how @expectedException and <em>setExpectedException()</em>
can be triggered by other errors in your tests (including other exceptions
being unexpectedly triggered. He feels that by using try / catch you have
much better control over when and where you wish to trigger an exception.</p>

<p>To quote Brain's post:</p>

<blockquote>
  <p>"The basic idea here is that the most specific test is best, because
  you have the least likelihood of a false negative or a test error slipping
  through the cracks."</p>
</blockquote>

<p>If you are making sure that every test is the most specific test that you
can write, then you NEVER have to worry about whether or not some other
code under test is throwing an exception or other error that is messing up
the current test.</p>

<p>Using try-catch because you want to not miss errors that might occur before
you deliberately throw an exception is a sign that you are doing too much
in that test.</p>

<p>A test failure is a test failure, no matter what caused it. The harder you
work to make sure that a test is actually testing the most specific thing
possible, the less likely you have to worry about the things that Brian
feels require him to use try / catch.</p>

<p>This is the same reason I don't like seeing tests like this:</p>

<ul>
<li>do Task A </li>
<li>do an assertion on the results of Task A</li>
<li>do Task B </li>
<li>do an assertion on the results of Task B</li>
</ul>

<p>Those are really two separate tests, so split them up. In fact, you could 
write two tests that look like this:</p>

<ul>
<li>do Task A</li>
<li><p>do an assertion on results of Task A</p></li>
<li><p>do Task A</p></li>
<li>do Task B</li>
<li>do an assertion on the results of Task B</li>
</ul>

<p>That second test doesn't need to re-assert that Task A did it's job because
Task A was already covered in the previous test.</p>

<p>Test smells, testing anti-patterns, whatever you want to call them, do exist
and many programmers are often unaware of the consequences of those decisions
are.</p>

<p>Keep your tests small, keep them very specific, and don't use conditional
logic in your tests. I have yet to see a specific example where the use
of conditional logic did anything except reduce the amount of lines of
code a grumpy developer didn't want to type.</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/blog/2013/03/30/grumpy-culture">The Grumpy Programmer&#039;s Guide To Software Company Culture</a></h2>
        </header>
        <div>
            <p>My co-worker <a href="https://twitter.com/chipersoft">Jarvis</a> wrote a blog post
about how he <a href="http://chipersoft.com/p/I-Dont-Care-About-Your-Culture/">doesn't care about your company culture</a>.</p>

<p>I don't know what prompted this blog post, but I disagree with many fundamental
parts of it. Jarvis seems like a decent guy (have only met him online and not
yet in person) but I think Jarvis is making a mistake that many people (not
just software developers) make: thinking that the rest of the world should
think like you when it clearly doesn't.</p>

<p>Initially I was going to make a point-by-point takedown of his blog post, but
halfway through it I realized I was being an asshole. So instead I want to
discuss where I think he's wrong.</p>

<p>I mentioned on Twitter to Jarvis that it's just as important to work on your
co-workers as all the other things you do. He said two interesting things in
response:</p>

<ul>
<li>"This is what I don't like about big companies"</li>
<li>"I work on computers, not people"</li>
</ul>

<p>First, I've worked at places both big and small. There is nothing inherently
better about either type. Do not kid yourself thinking only great things
happen at small companies. Great things happen when groups of smart people
get together and are given permission to go make it happen.</p>

<p>I've seen it work at large places where managers "ran interference" so their
employees could make stuff happen. I've seen small places stifle creativity
in their employees out of fear of change.</p>

<p>It's not the size of the company that matters, it's how they choose to work
together that matters.</p>

<p>The second point is the one where I think Jarvis has made the biggest mistake
in his approach.</p>

<p>We work FOR people USING computers. The computer is a tool
to achieve a goal. Those goals are achieved by working with others, whether
you wish to believe that or not.</p>

<p>As someone who has worked from home for a long time, I understand and
sympathize with many of the things Jarvis indicates that bug him. Noise
from co-workers, drive-by meetings, feeling pressure to participate in
social activities.</p>

<p>But at the end of the day, to accomplish anything of substance requires me
to interact with others in REAL TIME. I have proven that I can both get work
done AND not be such an asshole that others choose to ignore the remote
worker instead of working hard to integrate me into the team.</p>

<p>I find that socializing with my co-workers is a good way to learn about the
people I work with, so that when I need something from them later they are
less likely to say "why the fuck should I help that guy?" I need their help
as much as they need mine.</p>

<p>Of course, I don't think this bit at the end helps much:</p>

<blockquote>
  <blockquote>
    <p>I am extremely productive in this setting. For five years I have cranked out more code in this room than many people have written in their entire careers.</p>
    
    <p>I am exceedingly good at my job and I am sick of being told that my lack of cultural involvement makes me a bad employee.</p>
    
    <p><em>mic drop</em></p>
  </blockquote>
</blockquote>

<p>Disrespecting co-workers isn't always the smartest move. Failing to understand
why others think that being aloof and distant and insisting that results matter
more than how you treat people isn't always the smartest move either.</p>

<p>Tech is not a meritocracy, despite our wishes for it to be. Jarvis, you're not
alone in wanting people to just leave you the hell alone so you can get some
work done. I am that way many times, but I make sure to create those bonds
with my co-workers so that the amount of time that I spend with them is
enjoyable instead of resenting the time there.</p>

<p>Nothing creates bonds of friendship like a shitty job, but being friendly with
your co-workers costs you nothing but a little time, time you're probably
spending doing horrible things like reading the comments on Hacker News.</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/blog/2013/03/24/whats-in-chris-brain-birthday-edition">What&#039;s In Chris&#039; Brain - Birthday Edition</a></h2>
        </header>
        <div>
            <p>Today is my 42nd birthday, which is 420 in internet years. I am feeling old
but thankful that I have so many friends who keep lying to me and saying I'm
not a programming dinosaur.</p>

<p>I haven't done one of these blog posts in a while, so I thought I would solicit
some ideas from my Twitter followers and address a few of them.</p>

<h1>Can I unit test in 140 characters or less?</h1>

<p>No. Testing, in general, does not lead itself to brevity. The tools we use
to test our code in an automated fashion can only abstract so much away from
us before we actually have to write some code.</p>

<p>Large amounts of setup work is a sign that perhaps your code-under-test is
doing too much. Sometimes it is unavoidable if you are using dependency
injection to create multiple dependencies.</p>

<p>Of course, "large" is also subjective. I would offer my opinion on what "large
amounts of setup work" means to me, but that would just lead to people arguing
with me about testing when I'd rather argue about why dick jokes spoken at
conferences are the tip of the metaphorical iceberg that represents white male
privilege in the tech industry.</p>

<p><em>sigh</em></p>

<h1>What are your favourite Vim plugins?</h1>

<p>I group the plugins I use into two categories: "essential" and "everything else".
Right now, I only have four essential plugins:</p>

<ul>
<li><a href="https://github.com/tpope/vim-pathogen">Pathogen</a> for organizing my plugins</li>
<li><a href="https://github.com/ervandew/supertab">Supertab</a></li>
<li><a href="https://github.com/scrooloose/syntastic">Syntastic</a></li>
<li><a href="https://github.com/tpope/vim-surround">Surround.vim</a></li>
</ul>

<p>All other plugins swap in and out depending on my mood and whatever problems
I am attempting to solve in code. Right now I've got the following</p>

<ul>
<li><a href="http://www.vim.org/scripts/script.php?script_id=13">Closetag</a></li>
<li><a href="https://github.com/kien/ctrlp.vim">Ctrl-P</a></li>
<li><a href="https://github.com/scrooloose/nerdcommenter">NERD Commenter</a></li>
<li><a href="https://github.com/scrooloose/nerdtree">NERD Tree</a></li>
<li><a href="https://github.com/troydm/pb.vim">pb.vim</a></li>
<li><a href="https://github.com/kchmck/vim-coffee-script">Vim CoffeeScript</a></li>
<li><a href="https://github.com/airblade/vim-git-gutter">Vim Git Gutter</a></li>
<li><a href="https://github.com/pangloss/vim-javascript">vim-javascript</a></li>
<li><a href="https://github.com/tpope/vim-repeat">repeat.vim</a></li>
</ul>

<h1>Is Grumpy Cat your Cat?</h1>

<p>No.</p>

<h1>Life as a unicorn in Canada</h1>

<p>This was asked tongue-in-cheek by my <a href="https://twitter.com/PolarLava">boss</a>, who 
refers to me as his "Canadian unicorn" because of my unique status within 
the company  but
I think it's actually better re-framed as "what is it like working in a senior
role when you are remote?"</p>

<p>First, my co-workers go to great lengths to make sure that myself and the
two other remote workers in a group of over a dozen (I cannot remember all
the people who are on the other team that makes up our group) are integrated
into all decisions.</p>

<p>We have been experimenting with using Google+ Hangouts as a way for all the
remote workers to see what's going on in the office. Despite my initial
reservations that it's simply a way for nervous management to keep an eye on
us I think it has worked out well. They've created a permanent "remote station"
and people have walked up to it to find one of us and ask us directly a
question.</p>

<p>It's growing on me, and I have also started looking at this awesome site on
<a href="http://remotepairprogramming.com/">making remote pair programming smoother</a> 
for inspiration on how to make it better. I already use my iPad as my "personal device"
while working from home, so it seems natural to start using it as my visual gateway
into the office.</p>

<p>Second, because I am remote and therefore trusted to work for long stretches
of time with Eyeball Supervision (a.k.a walking up behind you and asking what
you're working on) you get assigned tasks that can be done by one person
(sometimes two if the other can be dedicated to the task) and take a while
to do.</p>

<p>Unless you make the commitment to do remote pair-programming (which I have
done with great success) you should get used to working on stuff in a directly-unsupervised
fashion.</p>

<p>This suits me just fine.</p>

<p>Finally, make sure that everyone who has to work with you knows that just because
you are remote does not mean that you are unwilling to do one-on-one communication
with people. I have a soft phone that work has provided me, and I get phone calls
from co-workers asking me stuff. I do Skype calls and lots of text chats.</p>

<p>In other words, I probably talk to my co-workers about work-related stuff
as much as anyone else in the office.</p>

<p>What I miss out on are the social events that happen. That sucks, but I always
make sure to do something at my end (and expense it ;) ) very similar to 
what my co-workers are doing. If they get pizza during a tech presentation, I
make sure to order myself something similar.</p>

<p>Remember, being remote does not mean that you are invisible.</p>

<h1>Productivity and task management tips</h1>

<p>How does this grumpy guy get things done while working remotely?</p>

<ul>
<li>pay attention in meetings so that you are not forced into positions that
are untenable for you</li>
<li>work hard to get everything done that you have promised to do</li>
<li>work hard to communicate with everyone because you can't just walk over to
their cubicle / office to bitch at them for not getting stuff done on your own
schedule</li>
</ul>

<p>That's it really. Get stuff done, do good work, and there will be fewer and
fewer excuses for your employer to prevent others from reaping the rewards
of your trail-blazing efforts.</p>

<h1>A Day in the life of a Grumpy Programmer</h1>

<ul>
<li>woken up at 6am by the Office Manager, who is seeking cat treats for himself
and the HR Manager</li>
<li>lay in bed in a daze until 6:45am when my wife is showered, dressed and heads
downstairs.</li>
<li>wake kids up at 7am and putter around getting breakfast and lunches together</li>
<li>throw kids out of the house between 8am and 8:15am so they are not late for
school</li>
<li>have breakfast, work out, shower and start my day</li>
</ul>

<p>For the rest, just follow me on Twitter to get a feel for my mood. ;)</p>

        </div>
            </article>
    <nav>
        <a href="/page/142">Newer Posts</a><br />
        <a href="/page/144">Older Posts</a><br />
    </nav>
                </div>
                <div class="span4 sidebar">
                    <div class="well">
                        <h4>@TheKeyboard <small>The ramblings of a grumpy programmer</small></h4>
                    </div>
                    <div class="well sidebar-nav">
                        <h4>Links</h4>
                        <ul class="nav">
                            <li><a href="http://sculpin.io">sculpin.io</a></li>
                            <li><a href="http://twitter.com/getsculpin">@getsculpin</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <footer class="container">
            &copy; 2014 @TheKeyboard
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/components/jquery/jquery.min.js"><\/script>')</script>
        <script src="/components/bootstrap/js/bootstrap.min.js"></script>
                
                <script src="/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
