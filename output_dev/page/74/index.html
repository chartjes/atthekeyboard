<!DOCTYPE html>
<html>
    <head>
        <title>Home &mdash; @TheKeyboard &mdash; The ramblings of a grumpy programmer</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/components/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
        <link href="/css/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="stylesheet" href="/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="@TheKeyboard activity feed" />
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
        </style>
    </head>
    <body>
        <header>
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="/">@TheKeyboard</a>
                        <div class="nav-collapse collapse">
                            <ul class="nav">
                                <li><a href="/blog">Posts Archive</a></li>
                                <li><a href="/blog/categories">Categories</a></li>
                                <li><a href="/blog/tags">Tags</a></li>
                                <li><a href="/about">About</a></li>
                            </ul>
                        </div><!--/.nav-collapse -->
                    </div>
                </div>
            </div>
        </header>
        <div class="mainContent container">
            <div class="row-fluid">
                <div class="span8">
                        <article>
        <header>
            <h2><a href="/_posts/2007-12-11-the-story-and-rebirth-of-zend_service_audioscrobbler-part-1.markdown"></a></h2>
        </header>
        <div>
            <hr />

<p>layout: post
title: The Story and Rebirth Of Zend_Service_Audioscrobbler, Part 1
date: 2007-12-11</p>

<h2>author: Chris Hartjes</h2>

<p>
Many moons ago I set out (along with my friend <a href="http://derekmartin.ca">Derek</a>) to make a contribution to <a href="http://framework.zend.com">Zend Framework</a> in the form of an add-on to let people easily access the <a href="http://www.audioscrobbler.net/">Audioscrobbler</a> web service.  We worked really hard, implemented all the features of the web service at that time.  Imagine our surprise when it got accepted as part of the 1.0 release of Zend Framework!  Awesome!  It even has <a href="http://framework.zend.com/manual/en/zend.service.audioscrobbler.html">it's own entry in the manual and everything.</a></p>

<p>
However, I have a confession to make, although it will not come as a surprise to anyone who reads my blog on a regular basis:  the code is a complete piece of shit.  There.  I said it.  How do I know that it's terrible and needs refactoring in a fierce way?  Check out this lovely snippet of code:
~~~
    //////////////////////////////////////////////////////////
    ///////////////////////  USER  ///////////////////////////
    //////////////////////////////////////////////////////////

    /**
    * Utility function to get Audioscrobbler profile information (eg: Name, Gender)
    * @return array containing information
    */
    public function userGetProfileInformation()
    {
        $service = "/{$this->get('version')}/user/{$this->get('user')}/profile.xml";
        return $this->getInfo($service);
    }

    /**
     * Utility function get this user's 50 most played artists
     * @return array containing info
    */
    public function userGetTopArtists()
    {
        $service = "/{$this->get('version')}/user/{$this->get('user')}/topartists.xml";
        return $this->getInfo($service);
    }

    /**
     * Utility function to get this user's 50 most played albums
     * @return SimpleXML object containing result set
    */
    public function userGetTopAlbums()
    {
        $service = "/{$this->get('version')}/user/{$this->get('user')}/topalbums.xml";
        return $this->getInfo($service);
    }
~~~
It goes on and on and freakin' on like this.  SEVENTEEN methods just for dealing with user stuff.  This is insane.  Going back over the comments when I was building this thing I realized I totally ignored created elegant code and instead just 'banged out something that worked'.  So, I'm going back to the drawing board and are going to refactor this puppy so it makes sense.   First up, let's talk about dealing with users.  Wouldn't it be better if we had something like this:
~~~
public function user($action) {
     $service = "/{$this->get('version')}/user/{$this->get('user')}/{$action}.xml";
     return $this->getInfo($service);
}
~~~
Now, THAT looks like nice and elegant.  All I have to do is establish the convention on how to connect to various user-related web services.  That's as simple as comments in the file itself.  Now, to replicate what I was doing before, here are how simple the calls could be:
~~~
$zsa = new Zend_Service_Audioscrobbler();
$zsa->set('user', 'chartjes');
$zsa->set('version', '1.0');
$userProfile = $zsa->user('profile');
$userTopArtists = $zsa->user('topartists');
$userTopAlbums = $zsa->user('topalbums');
~~~
I think I just got rid of something like 200 lines of code...and that's just in the user section.  Clearly, I majorly screwed it up when I did it the first.  Luckily for me, there is built-in testing for all this stuff so I can refactor and test as I go.</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/_posts/2007-12-18-the-story-and-rebirth-of-zend_service_audioscrobbler-part-2.markdown"></a></h2>
        </header>
        <div>
            <hr />

<p>layout: post
title: The Story and Rebirth of Zend_Service_Audioscrobbler, Part 2</p>

<h2>author: Chris Hartjes</h2>

<p>
So, dear readers, I received some nice emails and comments from those you have used Zend_Service_Audioscrobbler, along with having a nice email conversation with Wil Sinclair from Zend (who is involved with Zend Framework).  Wil told me that backwards compatibility for the 1.5 version is important so I can't just rip everything up like I want to.  Well, I could but it probably wouldn't be accepted.  I'd have to write some letter to convince the Elder Gods Of Zend Framework of why I needed to break backwards compatibility.  In Wil's words: "?I find it embarrassing and want to destroy the evidence? will not be considered a good enough reason. ".
</p>

<p>
I had a good chuckle at that, but Wil did offer up a very good suggestion on how to go about the refactor that I hadn't thought of:  use a _call() method in the class to intercept all the old calls and translate them into new calls.  I would also get it to trigger a warning that the old method would be deprecated in a future release as a way to get people to upgrade to the newer ones.  Once I have some code, I will show it.  Thanks Wil!
</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/_posts/2007-12-20-christmas-with-a-little-flex-2-it.markdown"></a></h2>
        </header>
        <div>
            <hr />

<p>layout: post</p>

<h2>title: Christmas With A Little Flex 2 It</h2>

<p>
Many thanks to <a href="http://www.riapedia.com/blog/mike">Mike Potter</a> for sending me a copy of O'Reilly's "Programming Flex 2", which had been on my Amazon Wish List.  It will be some light reading over the Christmas holidays.  Thanks Mike!
</p>

<p>
Now, if I can scrape the money together for a copy of Flex Builder then I can perhaps use a Flex front end for my sporting road-trip planning site...
</p>

        </div>
            </article>
    <nav>
        <a href="/page/73">Newer Posts</a><br />
        <a href="/page/75">Older Posts</a><br />
    </nav>
                </div>
                <div class="span4 sidebar">
                    <div class="well">
                        <h4>@TheKeyboard <small>The ramblings of a grumpy programmer</small></h4>
                    </div>
                    <div class="well sidebar-nav">
                        <h4>Links</h4>
                        <ul class="nav">
                            <li><a href="http://sculpin.io">sculpin.io</a></li>
                            <li><a href="http://twitter.com/getsculpin">@getsculpin</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <footer class="container">
            &copy; 2014 @TheKeyboard
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/components/jquery/jquery.min.js"><\/script>')</script>
        <script src="/components/bootstrap/js/bootstrap.min.js"></script>
                
                <script src="/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
