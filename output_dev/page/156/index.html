<!DOCTYPE html>
<html>
    <head>
        <title>Home &mdash; @TheKeyboard &mdash; The ramblings of a grumpy programmer</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/components/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
        <link href="/css/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="stylesheet" href="/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="@TheKeyboard activity feed" />
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
        </style>
    </head>
    <body>
        <header>
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="/">@TheKeyboard</a>
                        <div class="nav-collapse collapse">
                            <ul class="nav">
                                <li><a href="/blog">Posts Archive</a></li>
                                <li><a href="/blog/categories">Categories</a></li>
                                <li><a href="/blog/tags">Tags</a></li>
                                <li><a href="/about">About</a></li>
                            </ul>
                        </div><!--/.nav-collapse -->
                    </div>
                </div>
            </div>
        </header>
        <div class="mainContent container">
            <div class="row-fluid">
                <div class="span8">
                        <article>
        <header>
            <h2><a href="/blog/2011/11/03/infrastructure-debt">Infrastructure Debt</a></h2>
        </header>
        <div>
            <p>You might have come across the term "technical debt", used to describe the small
mistakes that are made in your code base as the application grows and requirements
change. You end up with a big tangled mess if you are not very careful about
how you make those changes. If you've ever worked on an application where you
were afraid to make changes for fear of breaking something, then you have
run into technical debt.</p>

<p>It's very easy to build up technical debt: you put a quick hack in because you
feel like you are under pressure to get a task accomplished. It takes courage
to push back and say "no, damnit, I need time to fix this particular problem
correctly!". I understand, and it's okay. We can hug it out if it will make
you feel better.</p>

<p>Technical debt can be dealt with via ruthless refactoring and wrapping your
application in tests that poke and prod at the edge cases that your application
deals with. But there is another type of debt you end up dealing with. One that is
even more difficult to deal with and change. I call it infrastructure debt.</p>

<p>Infrastructure debt is debt that you build up because you have not been paying
attention to the process of creating the environments your application will exist
in and have not been paying attention to the process of how your code gets from
development into production. In my opinion, infrastructure debt is much more 
difficult to "pay off" than technical debt. Why? It is often very difficult
for people to understand that it even exists.</p>

<p>Before I go any further, if you are not using a version control system to keep
track of changes to your code, then please stop reading and go and install one.
Having versions of your files with extensions like .1 and .old is the worst
kind of infrastructure debt that you could possibly have. It's the 2nd decade
of the 21st century. Version control is an almost 40-years-old, well-understood concept.
Nothing I suggest will work if you insist on acting like version control
is of no use to you. Passing around diff patches is not version control, my
friends. It's denial. Don't tell me just because people used to do it in
the past that it's okay now given all the available options. People used to
think that the earth was flat once too.</p>

<p>Let's start with an easy infrastructure debt to pay off: inconsistency in development environments. These
days it is pretty easy for someone to create a development environment for their
language of choice along with associated components like databases. The problem?
That it's pretty easy for someone to create the development environment of their
choice.</p>

<p>You end up with your developers all having environments that are slightly different
due to choice of source for packages or preferences on versions of components. I have
PHP 5.3.8 via a custom Homebrew recipe while one of my co-workers has the stock
version of PHP that comes with OS-X Snow Leopard. He has a version of MySQL that is
two versions ahead of mine. See how easy it is to get out of sync?</p>

<p>You have two options. The first one is the draconian one, where you force everyone
to use the same operating system and the same tools to minimize the chances of 
conflicts between development environments. Given how that leads to developer
unhappiness, I prefer a more sane approach: use tools like <a href="http://www.vmware.com">VMWare</a> or <a href="http://www.virtualbox.org">VirtualBox</a> to
let your developers do their work on identical virtual machines while giving
them the freedom to use the development and debugging tools of their own choosing.</p>

<p>Also, by using a virtual machine you can encourage developers to push the envelope
and test destructive things like library upgrades or database changes. Messed it up?
Just fire up a new virtual machine and try again. When you combine it with good
version control practices you should be able to recover from your mistakes even
faster.</p>

<p>Just make sure to take the time to create virtual machines that are as close to
an exact match as your production systems as you can. Honestly, the only difference
between your development environment and your production environment should be the data
your application is manipulating. It's not really that hard to even create
a cluster of virtual machines on your own computer to simulate an architecture
that has application servers, a database server and a memcached server.</p>

<p>It also helps you to get new developers up to speed quickly. "Oh, working on 
Project Alpha? I'll email you the link on the wiki where you can download
the virtual machine for that project."</p>

<p>Check out <a href="http://vagrantup.com">Vagrant</a> for a great option for developers
wishing to do their work in a virtual machine.</p>

<p>So, having injected some structure into your development environment there is
really one last frontier where infrastructure debt builds up like the
credit card bills of a shopaholic: deployment processes.</p>

<p>I really think there is one rule: if you cannot do your deployments with one
command then you are DOING IT WRONG. If you can type the commands you are 
doing into a shell then you can script them so you don't have to type
them in again. If you can script deployment, then you can automate
deployment. If you can automate deployment then you now have a consistent
and repeatable process that will behave the same way every single time
you deploy.</p>

<p>At <a href="http://www.moontoast.com">Moontoast</a> we have automated deployment in place.
When we merge code into our staging and production branches, a version control
hook triggers our deployment tool. It checks out our code into it's proper
location on the production server. It runs database migrations that need
to be done. It starts and restarts various services that are used by the
application. In short, it does everything that I see far too many of my
colleagues doing manually. Stop that. Clean up your infrastructure debt
by making the process of deploying your code a non-event.</p>

<p>If you want to automate your deployment process, examine tools like 
<a href="https://github.com/capistrano/capistrano/wiki">Capistrano</a> or <a href="http://www.phing.info/trac/">Phing</a>
or you could even use a tool like <a href="http://jenkins-ci.org">Jenkins</a> and use
it's concept of Builds to automate the process of taking your latest code
changes into production.</p>

<p>Note that I said the PROCESS, because technical debt might mean that your
application is fragile enough (doesn't have enough tests and/or test coverage)
that the changes you made might cause it to behave improperly or even crash
the system altogether. Not a good feeling, so by investing the time into
automating your deployment process you can eliminate at least one headache.</p>

<p>I think the main point I am trying to get across with respect to infrastructure
debt is that you really need to examine your processes beyond just coding. 
If you find yourself constantly fighting the "works on my computer" battle, 
you likely have serious infrastructure debt. If you find yourself constantly
referring to a checklist whenever you do a deployment, you likely have serious
infrastructure debt.</p>

<p>Whenever I bring this topic up, I hear many of the same excuses that I hear
when I advocate a commitment to writing tests and automating the execution
of those tests. What is it that people have against this sort of thing?</p>

<p>I have found that people terribly underestimate the amount of manual work they
do to accomplish a task. For many, it is a fear of losing control that leads
them to conclude that automated deployment cannot be trusted, or that 
developers shouldn't have the freedom to pick the tools that they use to 
build their applications.</p>

<p>Technical debt is real, make no mistake. But so is infrastructure debt. Just like
the cost of finding bugs in production is more than finding them in development,
the cost of fixing infrastructure debt gets more and more expensive. Just think
of the large number of problems solved by eliminating inconsistencies between
development environments. Add to that the ability to eliminate user error
during manual deployments of your application. Why would you not want to have 
this?</p>

<p>The decision to start paying down your infrastructure debt is not an easy one,
because it will often require many changes to be made by many people. Most
programmers are creatures of habit and dislike change, even when it is 
obviously better. Don't be scared of change, be scared of the debt growing
in your code base and in your infrastructure. It won't go away and
there is no government bailout on the way to fix it.</p>

<p>As always, I welcome your thoughts via email, Twitter and comments on this blog. 
What sort of infrastructure problems have you come across and how did you fix them?</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/blog/2011/10/10/grumpy-programmers-guide-to-remote-working-part-1">The Grumpy Programmer&#039;s Guide To Remote Working, Part 1</a></h2>
        </header>
        <div>
            <p>Well, I couldn't very well call this post <a href="https://twitter.com/weierophinney/status/122317724117516288">MOAR OFFICE PORN</a> as <a href="http://weierophinney.net/matthew/">MWOP</a> suggested.</p>

<p>I have talked before on this blog about stuff related to what goes into being a successful remote worker. I've been telecommuting for 4-1/2 years now and it's the best thing that ever happened to my career. It allowed me to grow into the programmer I am today by teaching me the importance of being disciplined, learning how to communicate effectively in a remote environment, and how to not take shit from anyone just because I wasn't in the same office as them. This will be the first article in a series about what I think are some successful strategies for being a good remote worker. Today's lesson is about creating an effective workspace.</p>

<p>When I used to do my killer commute to work every day (1-1/2 hours in, 2 hours out) I had the misfortune of working for employers who did not believe that creative people (yes, that means you mister programmer) needed quiet and private (or at least semi-private) working space in order to get things done. Instead I usually ended up either in the cubicle farm or in that phrase that inspires the most fear for me: the open concept office. Except for the managers of course. They always had offices with doors that could be closed.</p>

<p>So now that you work at home, guess what? You can finally create the environment that will allow you to easily get into that state of focussed work that some refer to as The Zone. No working at coffee shops for this grumpy guy. Small tables, crappy chairs, and people staring at you while you're trying to work. I'm not doing top-secret work for the government, I'm just trying to build some rock-solid web applications. Eyes on your own crappy life, please.</p>

<p>For me, I started off working in the unfinished basement of my house on a make-shift desk that consisted of an old desktop from a broken desk (well, not really broken but I couldn't find a bunch of lock nuts to put it back together after I moved) on top of two filing cabinets. I bought a decent chair (more on that later) and was okay to work. Until it was winter in my part of Canada. The basement was pretty much unheated so by 2 PM my hands were numb.</p>

<p>So at my wife's insistence I moved into the dining room. Almost the same problem as working from the coffee shop, except I had a better chair and no people starting at me. Just the cats, but they never debugged my code properly anyway. Plus she complained about the reproducing paper up the table: bills I paid that hadn't moved down to the filing cabinet in the basement, printouts of instructions and scoresheets for my simulation baseball league. The time came for us to consider trying to use the space in our basement for something productive. So we sank $25K into renovating the basement: laundry room, wreck room for the kids (get the joke?), two storage areas, and a home office for me.</p>

<p>So, what is the configuration that allows me to get into the proper frame of mind to program? Well, the first one is a door that I can close. Call me a princess but sometimes I need to block out the noise from the rest of the house in order to get things done. Especially when the kids are home from school during the last two hours of my normal working day. They argue and make lots of noise when watching TV, so the door gets closed. If I get especially grouchy I lock the door too and make them call me via our phone's intercom system.</p>

<p>I've never liked the idea of putting on headphones to block out the outside world. I find long-term headphone wearing to be hot and uncomfortable. Yes, I used to wear earbuds during my long commute but I wasn't trying to solve any problem other than mentally cooling down from a long day at work. So an office with a door I can close means I can crank up the tunes if required but also give myself a nice quiet zone when I really need it.</p>

<p>Next essential item? Another piece of furniture other than a chair that you can sit on. Until recently all I had was my awesome "fat man chair" (big comfy leather chair that can handle up to 350 pounds of weight). Sometimes I wanted to move away from my desk to work out a problem with paper and pen, or even just to lay down for a minute while talking in a meeting. Hey, don't blame me because I work from home. Make it happen for yourself before picking on me!</p>

<p>Anyway, we recently pulled up the grotty carpet in our house and had laminate flooring installed. I got the people who did the floor to help me move on part of our three-piece sectional down into my office. Now I have a <a href="https://en.wikipedia.org/wiki/Fainting_couch">fainting couch</a> to sit on. Most useful piece of furniture in my office. Do not underestimate the importance of having something else to sit on.</p>

<p>Now, more about the desk. I still have my terrible desk, but with my awesome adjustable chair I have comfort while sitting my large frame down. I'm 6'5", 285 lbs of grumpy programmer. The world is not made for people my size. It was worth the money ($300 at the local office supply place, they had only one in stock) for my chair, so I always recommend people try out several chairs and get the one that the think they could sit in for the longest. Yes, I know that standing desks are all the rage right now, but I think you are trading one set of problems for another. Maybe standings desks work for you.</p>

<p>My next home office purchase will be an adjustable desk from Ikea to get the perfect height for working, as I find my current setup to be just a tad too low. Again, having the ability to adjust the height of your desk to an optimal height based on your chair is critical too. I'd love to fork out the $1500 to get one of those awesome adjustable <a href="http://www.geekdesk.com/">Geek Desks</a> but that will have to wait for me to set aside enough money for purchase and delivery.</p>

<p>So, now my actual working setup. I have a 15" MBP generously purchased for me by my employer. Connected to that I have an Apple keyboard and mouse, and view things via a really nice 23" LCD monitor. What I really want is one of those Apple Studio Displays, but again that will have to wait until I can set aside enough money for such a purchase. Right now, I'd say that is my optimal configuration. I very rarely refer to the laptop screen, and like the amount of real estate I have now. Perhaps I could move to a two-monitor setup but I need more physical space on my desk to make it happen. Hrm, I will have to measure the new desk to see what will fit...</p>

<p>Anyway, in part two I will talk about how my programming style and support tools have changed since I've been working remotely.</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/blog/2011/09/14/blogging-framework-for-hackers-is-the-right-label">&#039;Blogging framework for hackers&#039; is the right label</a></h2>
        </header>
        <div>
            <p>I don't regret moving from a Wordpress-powered blog to one that is created using a static site generator. But I can definitely say that the journey
to a static site (initially <a href="http://github.com/mojombo/jekyll">Jekyll</a> and now using <a href="http://octopress.org">Octopress</a>) is not a path I would recommend
to anyone who is not comfortable debugging issues from the command line or unable to write conversion tools from scratch depending
on the situation.</p>

<p>While I do like how easy Octopress makes it to manage my blog I find the whole setup to be, like so many other tools and web applications I've come across, to be brittle. Too many moving parts. Too much reliance on things being perfect and if they're off by even the tiniest bit everything falls apart. I am by no means innocent of creating brittle applications but I try and go out of my way these days to create things that are as robust as possible in the constraints of the existing system.</p>

<p>For me it was <a href="https://rvm.beginrescueend.com/">RVM</a>, the "Ruby Version Manager". I like to call it "what <a href="https://github.com/pypa/virtualenv">virtualenv</a> would look like if Ruby guys got their hands on it". On the surface it sounds awesome: it sets up an environment containing the Ruby binary you want and the Ruby gems you want, isolating this application from whatever the defaults were on the system. Just like virtualenv. Sounds incredibly useful. But when it breaks, it breaks and there is NO way to tell what the hell has happened.</p>

<p>Somehow through deleting the .rvmrc file (the RVM config file) I managed to break my install of Octopress. This happened at the same time I upgraded the Octopress components by pulling from the master. I had no fucking idea what had happened, all I knew was that it wouldn't generate any more blog posts for me and was reporting errors about going too many stack levels deep, mal-formed YAML, and Unicode errors. Funny how none of that seemed to have mattered to Octopress before I updated.</p>

<p>In the end, I had to completely remove the install and start it up again from scratch. This is not what I call a successful error-resolution process. In my mind I shouldn't have had to do this at all, but through the removal and re-addition of one file everything was completely messed up. One upside was that in the process of getting things back to "normal" I created two scripts that I hope can be of use to people who ran into the same problems I did.</p>

<p>I used the stock migration script for Jekyll for Wordpress users who had their posts in a database. The script reads all your posts in and then spits out new posts in the Markdown format that Jekyll expects. The new version of Octopress likes Ruby 1.9.2 which, as far as I can tell, is much less forgiving of mistakes in YAML and Unicode characters. I don't use Ruby so I am not as familiar with these issues. It sure sucked when I was searching for solutions to my problems.</p>

<p>So, I had 427 posts that had been converted and there was no way I was going to search through each one by hand to resolve the issues. So I needed two scripts: one to parse all the posts to check for invalid YAML and one to force re-encoding of the content of each post into UTF-8 (because that's how Jekyll and I roll). Being a polygot programming wannabe, the first script for YAML validation was in Python:</p>

<pre><code>#!/usr/bin/env python
import getopt
import os
import re
import sys
import yaml

from yaml import load, dump

try:
    from yaml import CLoader as Loader, CDumper as Dumper
except ImportError:
    from yaml import Loader, Dumper

class Usage(Exception):
    def __init__(self, msg):
        self.msg = msg

def main(argv=None):
    if argv is None:
        argv = sys.argv

    try:
        try:
            print "Checking markdown files in the current directory..."

            #root = "/Users/chartjes/Documents/atthekeyboard/source/_posts"
            for r,d,f in os.walk('.'):
                for file in f:
                    fp = open(file, 'r') 
                    contents = fp.read()
                    marker = "---"
                    a = contents.find(marker)
                    b = contents.find(marker, a + len(marker))
                    try:
                        yaml_to_parse = contents[a:b]
                        yaml.load(yaml_to_parse)
                    except:
                        print "%s is invalid YAML" % file
        except getopt.error.msg:
            raise Usage(msg)
    except Usage, err:
        print &gt;&gt;sys.stderr, err.msg
        return 2

if __name__ == "__main__":
    sys.exit(main())

</code></pre>

<p>It took me a while to find some code to extract just the YAML from the posts, and I am not 100% happy with the result but it did the job and identified a handful of posts that made it through the migration and didn't properly wrap post titles with colons (which YAML thinks is bad) in quotes. With the bad YAML fixed I then had to fix any bad characters in the posts. For that I dragged out my copy of "Programming Ruby" (proudly proclaiming on the cover that it was a Second Edition covering Ruby 1.8) and stole some code from a conversion script someone wrote for Wordpress blogs if you dumped the contents as XML.</p>

<pre><code>#!/usr/bin/env ruby
require 'fileutils'

markdown_files = Dir["*.yml"]

markdown_files.each do |m|
    puts "Converting #{m}"
    f = File.new(m)
    post_contents = f.read
    content = post_contents.encode("UTF-8")
    new_file = File.new(m + "-new", "w+")
    new_file.write(content)
    FileUtils.mv(m + "-new", m)
end
</code></pre>

<p>Like I said, I'm happy I switched but the brittleness of the whole setup is something I find annoying. I realize that Octopress probably started it's life as one person's set of tools they were using to manage a Jekyll blog. The process of turning that extraction into a general-purpose tool is a difficult one and I want to say thank you to <a href="https://github.com/imathis">Brandon Mathis</a> for providing quick and useful information in the #octopress channel on Freenode while I tried to figure out how to fix the problems I was facing.</p>

<p>(Edit: On Twitter Octopress' creator felt I was <a href="https://twitter.com/#!/imathis/status/113991077555474433">saying that everyone must endure what I went through</a>, which isn't the case. My point was that the whole setup seems fragile to me and that one little mistake shouldn't make everything blow up like it did. Now that I know what to look out for, this shouldn't happen again. Cheer up Brandon!)</p>

        </div>
            </article>
    <nav>
        <a href="/page/155">Newer Posts</a><br />
        <a href="/page/157">Older Posts</a><br />
    </nav>
                </div>
                <div class="span4 sidebar">
                    <div class="well">
                        <h4>@TheKeyboard <small>The ramblings of a grumpy programmer</small></h4>
                    </div>
                    <div class="well sidebar-nav">
                        <h4>Links</h4>
                        <ul class="nav">
                            <li><a href="http://sculpin.io">sculpin.io</a></li>
                            <li><a href="http://twitter.com/getsculpin">@getsculpin</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <footer class="container">
            &copy; 2014 @TheKeyboard
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/components/jquery/jquery.min.js"><\/script>')</script>
        <script src="/components/bootstrap/js/bootstrap.min.js"></script>
                
                <script src="/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
