<!DOCTYPE html>
<html>
    <head>
        <title>Home &mdash; @TheKeyboard &mdash; The ramblings of a grumpy programmer</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/components/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
        <link href="/css/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="stylesheet" href="/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="@TheKeyboard activity feed" />
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
        </style>
    </head>
    <body>
        <header>
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="/">@TheKeyboard</a>
                        <div class="nav-collapse collapse">
                            <ul class="nav">
                                <li><a href="/blog">Posts Archive</a></li>
                                <li><a href="/blog/categories">Categories</a></li>
                                <li><a href="/blog/tags">Tags</a></li>
                                <li><a href="/about">About</a></li>
                            </ul>
                        </div><!--/.nav-collapse -->
                    </div>
                </div>
            </div>
        </header>
        <div class="mainContent container">
            <div class="row-fluid">
                <div class="span8">
                        <article>
        <header>
            <h2><a href="/_posts/2010-01-08-who-cares-what-i-think.markdown"></a></h2>
        </header>
        <div>
            <hr />

<p>layout: post</p>

<h2>title: Who Cares What I Think?</h2>

<p>So we're at a natural point for reflection.  It's the start of a new year *and* the start of a new decade.  Despite my wife rolling her eyes talking about this, it is an incredibly exciting time to be involved in web development.  Internet time is like dog time, in my opinion: one year online is seven years in the real world.  Of course, this is a gross oversimplification.  But I think it's accurate nonetheless.
</p>

<p>
So as we start 2010, and you're a web developer, what is out there for you to play with?  Let's see...
<ul>
<li>Mature web application frameworks for the Big 3 open source scripting languages (PHP, Python and Ruby) that can help you, when used properly, rapidly build applications, if you are willing to spend the time understanding the limitations of frameworks.  You might hate frameworks, but you certainly cannot ignore them.  Yes, you could consider WordPress itself to be a framework</li>
<li>Multiple languages that will run on the JVM that can be used for web development, if you are willing to spend the time understanding the JVM and how to get these things talking to Java as well.  Ignore the Java haters, I think this is a good trend.</li>
<li>Multiple actually-usuable-outside-of-small-projects alternatives to RDBMs, if you are willing to spend the time to figure out when you should use them.  The trend is towards having ridiculous amounts of data, and it appears that in the open source world the RDBMs is not up to the task.  Think <a href="http://incubator.apache.org/cassandra/">Cassandra</a>, <a href="http://code.google.com/p/redis/">Redis</a> and <a href="http://hadoop.apache.org/">Hadoop</a> along with <a href="http://hadoop.apache.org/pig/">Pig</a>.</li>
<li>multiple mature Javascript libraries that make creating all that awesome Ajax goodness easy, if you are willing to spend the time to pick one with the features you like</li>
<li>multiple mature (or soon-to-be mature) functional programming languages that can be used to build web applications, if you are willing to spend the time to learn functional programming.  I mean, really, how can you not look at <a href="http://clojure.org/">Clojure</a> and <a href="http://ftp.sunet.se/pub/lang/erlang/index.html">Erlang</a> and not be impressed?</li>
</ul></p>

<p>
But again, who cares what I think?  If you do care, then you are at the same place as me:  paralysis by analyses.  What framework should I pick?  Do I go document database or key-value store?  If I don't want to learn Java, can I do some stuff with <a href="http://www.scala-lang.org/">Scala</a> or see if <a href="http://www.jython.org/">Jython</a> is up to the task?  Can <a href="http://www.jquery.org">jQuery</a> do long-polling / comet stuff?  Is functional programming too weird for a web monkey like me to figure out?
</p>

<p>
Crap, that's a lot of stuff to worry about, isn't it?  Is it any wonder I get stressed out trying to figure out how to build stuff at work?  Or what stuff to dabble with in my spare time?  We are suffering from an embarrassment of riches, which is being hidden by the constant religious wars that developers seem to get embroiled in.  If it's not "my language is better than your language", it's "my editor is better than your editor".  "My programming paradigm is better than your programming paradigm."  "If you did interesting work, you'd get accepted to speak at conferences more".  (Sorry, that was me arguing with myself).
</p>

<p>
If anything, I have found that my focus is starting to change.  I've started realizing that what is really happening is that despite there being ridiculous amounts of choices of tools to solve problems, it has become EASIER to solve these problems.  In my planning for a work project I stumbled across the now-infamous <a href="http://toys.lerdorf.com/archives/38-The-no-framework-PHP-MVC-framework.html">Rasmus Lerdorf "The no-framework PHP MVC framework" blog post</a>.  While Rasmus is a programming god, he is also a very smart guy.  He understands that programming is about solving problems, and he (at least to me) seems to not have the ego that says you must build up your own complicated solutions to problems.
</p>

<p>
This has gotten me to consider how I had been approaching problems.  Too often, I have been approaching them from the code out to the display.  Worrying about the technology, instead of how people will use it.  Rasmus proposes an easy problem - a sample Ajax app that uses exactly 4 things: a scripting language, a Javascript library, a data storage source, and a data exchange format.  In his specific example he used (in order) PHP 5, Yahoo YUI,  sqlite and JSON.  You could've done this with Python, JQuery, MySQL and XML.  Or Ruby, Dojo, CouchDB, and JSON.  My point is that we often find ourselves caught up in what we are USING to build something rather than solving the problem.
</p>

<p>I have really dislike the idea of New Year's resolutions, because they are almost always broken.  But in this case, I think a few are warranted:  this year I resolve to do a better job of figuring out the problem I need to solve first and worry about the technology needed second.  Sometimes my desire to feed the part of me that wants the new and shiny takes control and creates a potentially bad solution.  Sure, it would be awesome to get paid to learn a new programming language and a new web application framework to go with it, but if it gets in the way of solving the problem, well, you've suddenly become the problem instead of the solution.  Sounds so cliched, doesn't it?
</p>

<p>
So, in the spirit of that, let's look at 3 problems I need to solve in the next little while that I perhaps can also use to feed the Imp of the New and Shiny:
<ul>
<li>Analysis of some MySQL slow-query logs are needed at work.  First solution was to play with a tools specifically for analyzing the slow query log.  They provided summaries that were simply not useful to me. Perhaps Pig + Hadoop will give me the high-level solution to collect the information we seek.</li>
<li>I have a very simple idea for collecting absurd stories you've told to your kids.  My first instinct was to create the project using a web application framework.  Upon reflection, perhaps the combination of WordPress and then a custom-written story submission and approval system is the better approach.</li>
<li>Plans are being made to create the next platform our company will use for online fantasy games.  Since we cover multiple sports, I have no desire to create a separate version of the platform for every sport.  Instead, inspired by the realization that Rails is nothing more than a DSL (or Domain Specific Language) on top of Ruby, I have started work on a very simple DSL for defining scoring rules.  Wouldn't it be awesome for the games admin to be able to select a stat category for a sport (say, rushing yards in football) and then use "(1 point each 10) + (5 at 100 total)" as the scoring rule?  Parsers are actually pretty easy as long as your DSL is consistent.</li>
</ul>
</p>

<p>
I hope I've made sense here, as I'm trying to show how I wish to change my approach to solving programming problems.  There is no doubt that I will pick up the new and shiny as I find a way to solve these problems.  Some might be written in PHP.  Some will be written in Python.  Some will be written in ScoreRule (to pull a name for my sports DSL out of my ass).  But the real winner is the people who will use these things.  Shhh, don't tell anyone:  I'm thinking about the end user for once instead of the programmer.
</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/_posts/2010-01-15-rallyhat-playing-with-couchdb-and-python.markdown"></a></h2>
        </header>
        <div>
            <hr />

<p>layout: post</p>

<h2>title: "Rallyhat: Playing with CouchDB and Python"</h2>

<p>Many thanks to <a href='http://twitter.com/janl'>Jan Lehnardt</a> for helping me out via IM to understand some concepts that I was having problems wrapping my mind around.</p>

<p>
Rallyhat is for the most part a programming experiment for me, designed to learn Python *and* produce an web application that is actually usable by someone other than me.  One of the technologies I'm using is <a href="http://couchdb.apache.org/">CouchDB</a> to store things.  I was having some problems getting both <a href="http://code.google.com/p/couchdb-python/">couchdb-python</a> working with permanent views (meaning views stored in CouchDB itself) as opposed to temporary views (meaning views generated in the code).
</p>

<p>
Now, couchdb-python looks to be a nice, simple interface to use.  The problem I found was the documentation is, what's the word I'm looking for?  Lacking.  Since Jan is an amazing teacher, he was patient with me and showed me that I could look at the documentation for couchdb-python via the Python REPL (aka the Python shell).  So, armed with this "how the hell could I not realize this" knowledge I figured out how to use it.  Yet another reason why I'm warming up to Python.  
</p>

<p>It was as simple as starting up the Python shell and then doing the following:
~~~
import couchdb
help(couchdb.client)
~~~
In there you will find code examples for each method, and then explanations of the parameters for each method.  All you really need in this case.  So I take back what I said about the documentation for couchdb-python being lacking.  I was just looking in the wrong place.
</p>

<p>
So, task #1 was to create the view I needed.  I decided to use Futon, the built-in interface to create my permanent view:
~~~
{
   "_id": "_design/searches",
   "_rev": "3-e7f43cfdd5a8ef62ae338bd1f19b3e95",
   "views": {
       "by_user": {
           "map": "function (doc) { emit(doc.user, {'date': doc.date, 'locations': doc.loations});}"
       }
   }
}
~~~
</p>

<p>This view would then live at http://couchdb.server//rallyhat/_design/searches/_view/by_user is you want to get every doc for every user.  To get just the docs belong to a specific user, you append ?key=<user> to the URL above.  Is that easy to understand or what?  As an aside, I am finding the <a href="http://books.couchdb.org/relax/">online version of CouchDB: The Definitive Guide</a> to be an awesome reference guide (once you remember to actually use it, thanks again Jan). With the view then created, the next step was to create the Python code to read in those views.</user></p>

<p>
~~~
     def get_by_user(self, username):
         my_searches = []
 
         if username:
             for row in db.view('searches/by_user', None, key=username):
                 info = db.get(row.id)
                 locations = json.loads(info['locations'])                                                
                 my_search = {'date': info['date'], 'locations': locations}
                 my_searches.append({'id': row.id, 'date': info['date'],
                                     'locations': locations})
     
         return my_searches
~~~          
</p>

<p>
With *any* Python library that you use, make sure to see if the author added help files to the package.  You'd be surprised to see what's in there...
</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/_posts/2010-01-27-creating-usable-forms-with-zend-framework.markdown"></a></h2>
        </header>
        <div>
            <hr />

<p>layout: post</p>

<h2>title: Creating Usable Forms With Zend Framework</h2>

<p><i>Note: These examples are using Zend Framework 1.9.5, with comes with Zend Server Community Edition 4.0.6 for OS-X</i></p>

<p>As I begin working on the admin area for a work application being built with <a href="http://framework.zend.com">Zend Framework</a>, I've been spending a lot of time starting and stopping on it.  Why?  Chalk it up to the extensibility of Zend Framework, who have clearly taken the "configuration" side of the "configuration vs. convention" philosophy when it comes to frameworks.  Before you get all worked up, remember that (a) I last used Zend Framework 3 years ago and (b) I got very used to relying on framework conventions to help me speed things up, a tactic used with great success in building <a href="http://cakephp.org">CakePHP</a> and <a href="http://codeigniter.com">CodeIgniter</a> applications.  Alas, those days are behind me and I am getting schooled in the wonders of "figuring everything out" and "object chaining is cool" and "why are there always more than one way to do something with this framework?!?".
</p>

<p>
So one of my first tasks is to create a form to allow people to create new leagues for a fantasy sports league.  Need a very simple form with three things in it: league name, sport and scoring period (which is how often we need to compile standings).  Sounds easy right? 
</p>

<p>
After searching around online for some examples of building simple forms, I was dismayed to discover there were two different ways of building the form.  I could (a) do it the long way and create specific instances of the form elements using Zend_Form_Element_X or (b) do it the short way and add them to the form by use of <a href="http://framework.zend.com/apidoc/1.9/Zend_Form/Zend_Form.html#addElement">Zend_Form::addElement()</a> and pass it the type of form element I want via an array.  For reasons I cannot explain initially, I decided to do things the long way.  Later on, I found out that doing it this way saved me from rewriting.
</p>

<p>
So, the approach I decided to use was to create a separate file that contains the form I want to use.  Why? Because I wanted to reuse this form for both "add a new league" functionality and "edit an existing league" functionality.  After figuring out that I needed to create a Bootstrap file for the module that the form was in (otherwise auto loading wouldn't work) here's what I cranked out:
~~~
class Admin_Form_League extends Zend_Form
{
    public function __construct($options = null)
    {
        parent::__construct($options);
        $this->setAction($options['action'])->setMethod('post');
    
        $name = new Zend_Form_Element_Text('name', array('required' => true));
        $sport = new Zend_Form_Element_Select(
            'sport', 
            array(
                'required' => true,
                'multiOptions' => array('baseball' => 'Baseball', 'football' => 'Football')
            )
        );
        $scoringPeriod = new Zend_Form_Element_Select(
            'scoring_period',
            array(
                'required' => true,
                'multiOptions' => array('daily' => 'Daily', 'weekly' => 'Weekly', 'monthly' => 'Monthly')
            )
        );
        $submit = new Zend_Form_Element_Submit('submit', array('label' => $options['submitLabel']));

        if (isset($options['leagueId'])) {
            $leagueId = new Zend_Form_Element_Hidden('id', array('value' => $options['leagueId']));
            $this->addElement($leagueId);
        }

        $this->addElements(array($name, $sport, $scoringPeriod, $submit));
    }
}
~~~
Perhaps you've noticed something different about this example compared to others you might have seen elsewhere?  Okay, I won't keep you in suspense about it.  I'm using the $options parameter when creating an instantiation of this particular form to pass some dynamic information.  Without this, it would be very difficult to reuse this form.  In this case, I pass in up to three different parameters:  the target for the form, the label I want on the submit button and (in the case where we're editing an existing record) the primary key of that league in the database.
</p>

<p>
So, then the next step is to tell my controller I want to use that form.  Ignore the database related stuff as I'm using <a href="http://www.doctrine-project.org/">Doctrine</a> and my use of that probably deserves it's own blog post down the line.
~~~
class Admin_IndexController extends Zend_Controller_Action
{
    protected $_flashMessenger = null;

    public function init()
    {
        $this->_flashMessenger = $this->_helper->getHelper('FlashMessenger');
        $this->initView();
    }

    public function indexAction()
    {
        $leagues = Doctrine::getTable('Leagues');
        $form = new Admin_Form_League(array(
            'action' => '/admin/index', 
            'submitLabel' => 'Add New League'
        ));

        if ($this->_request->getPost()) {
            $formData = $this->_request->getPost();

            if ($form->isValid($formData)) {
                $newLeague = new Leagues();
                $newLeague->fromArray($form->getValues(true));
                $newLeague->save();
            } else {
                $form->populate($formData);
            }
        }

        $this->view->leagues = $leagues->findAll()->toArray();
        $this->view->messages = $this->_flashMessenger->getMessages();
        $this->view->form = $form;
    }

}
~~~
</p>

<p>Nice and simple, and effective.  I also have another action that is for the editing or deleting an existing league.  Here's the controller for that
~~~
class Admin_LeaguesController extends Zend_Controller_Action
{
    public function init()
    {
        $this->_flashMessenger = $this->_helper->getHelper('FlashMessenger');
        $this->initView();
    }
    
    public function editAction()
    {
        $leagueId = $this->_getParam('id', 0);
        $leagues = Doctrine::getTable('Leagues');
        
        if ($this->_request->getPost()) {
            $formData = $this->_request->getPost();
            $form = new Admin_Form_League(array(
                'action' => '/admin/leagues/edit', 
                'submitLabel' => 'Update League',
                'leagueId' => $formData['id']
            ));
            
            if ($form->isValid($formData)) {
                $updateLeague = $leagues->find($formData['id']);
                $updateLeague->name = $formData['name'];
                $updateLeague->sport = $formData['sport'];
                $updateLeague->scoring_period = $formData['scoring_period'];
                $updateLeague->save();
                $this->_flashMessenger->addMessage('Updated league');
                $this->_redirect('/admin');
                exit();
            } else {
                $form->populate($formData);
            }
        } else {
            $leagueId = $this->_getParam('id', 0);

            if ($leagueId == 0) {
                $this->_redirect('/admin');
                exit();
            } else {
                $form = new Admin_Form_League(array(
                    'action' => '/admin/leagues/edit', 
                    'submitLabel' => 'Update League',
                    'leagueId' => $leagueId
                ));
            }
        }
        
        $results = $leagues->findById($leagueId)->toArray();
        $formData = array(
            'name' => $results[0]['name'],
            'sport' => $results[0]['sport'],
            'scoring_period' => $results[0]['scoring_period']
        );
        $form->populate($formData);
        $this->view->form = $form;
    }

    public function deleteAction()
    {
        $leagueId = $this->_getParam('id', 0);

        if ($leagueId == 0) {
            $this->_redirect('/admin');
            exit();
        }

        $leagues = Doctrine::getTable('Leagues');
        $deleteLeague = $leagues->find($leagueId);
        
        if ($deleteLeague->delete()) {
            $deleteMessage = 'Deleted league';
        } else {
            $deleteMessage = 'Unable to delete league';
        }

        $this->_flashMessenger->addMessage($deleteMessage);
        $this->_redirect('/admin'); 
        exit();
    }
}
~~~
</p>

<p>Nothing too earth-shattering I would think.  Armed with this, I can now display my form in two different places:
~~~
<h1>Admin home</h1>
<h2>Leagues</h2>
< ?php if (count($this->messages) > 0) : ?>
<ul>
< ?php foreach ($this->messages as $message) : ?>
<li>< ?php echo $message ?></li>
< ?php endforeach; ?>
</ul>
< ?php endif; ?>
<table border=1>
    <tr>
        <th>League Name</th>
        <th>Sport</th>
        <th>Scoring Period</th>
    </tr>
< ?php foreach ($this->leagues as $league) : ?>
    <tr>
        <td>< ?php echo $league['name'] ?></td>
        <td>< ?php echo $league['sport'] ?></td>
        <td>< ?php echo $league['scoring_period'] ?></td>
        <td><a href="/admin/leagues/edit/id/<?php echo $league['id'] ?>">Edit</a> <a href="/admin/leagues/delete/id/<?php echo $league['id'] ?>" onClick="return confirm('Are you sure you want to delete this league?');">Delete</a></td>  
    </tr>
< ?php endforeach; ?>
    <tr>
< ?php echo $this->form ?>
    </tr>
</table>
~~~
~~~
<h1>Edit league</h1>
</p>

<p>Use the form below to edit an existing league</p>

<table border=1>
    <tr>
        <th>League Name</th>
        <th>Sport</th>
        <th>Scoring Period</th>
    </tr>
    <tr>
< ?php echo $this->form ?>
    </tr>
</table>

<pre><code><br />&lt;p&gt;So I do that, and load up the form and...what the?  Damn, the default decorator for these elements is ugly.  I want my form fields to line up nicely inside my table (shut up, I know I should use CSS but this is an admin panel and I am in a hurry) so after finding &lt;a href="http://devzone.zend.com/article/3450"&gt;this article by Zend Framework architect MWOP&lt;/a&gt; I figured out how to create the exact decorator I wanted.  Here's the final version of my reusable form.
</code></pre>

<p>class Admin_Form_League extends Zend_Form
{
    public function __construct($options = null)
    {
        parent::__construct($options);
        $this->setAction($options['action'])->setMethod('post');
        $decoratorOptions = array(
            'ViewHelper',
            'Errors',
            array(array('data' => 'HtmlTag'), array('tag' => 'td', 'class' => 'element')),
        );</p>

<pre><code>    $name = new Zend_Form_Element_Text('name', array('required' =&gt; true));
    $name-&gt;setDecorators($decoratorOptions);

    $sport = new Zend_Form_Element_Select(
        'sport', 
        array(
            'required' =&gt; true,
            'multiOptions' =&gt; array('baseball' =&gt; 'Baseball', 'football' =&gt; 'Football')
        )
    );
    $sport-&gt;setDecorators($decoratorOptions);

    $scoringPeriod = new Zend_Form_Element_Select(
        'scoring_period',
        array(
            'required' =&gt; true,
            'multiOptions' =&gt; array('daily' =&gt; 'Daily', 'weekly' =&gt; 'Weekly', 'monthly' =&gt; 'Monthly')
        )
    );
    $scoringPeriod-&gt;setDecorators($decoratorOptions);
    $submit = new Zend_Form_Element_Submit('submit', array('label' =&gt; $options['submitLabel']));
    $submit-&gt;setDecorators($decoratorOptions);

    if (isset($options['leagueId'])) {
        $leagueId = new Zend_Form_Element_Hidden('id', array('value' =&gt; $options['leagueId']));
        $this-&gt;addElement($leagueId);
    }

    $this-&gt;addElements(array($name, $sport, $scoringPeriod, $submit));
}
</code></pre>

<p>}
~~~
</p>

<p></p>

<p></p>

<p></p>

<p></p>

<p></p></p>

<p>
I'm pretty sure that if I dig around some more, I can find info on how to automatically apply that decorator to ALL my form elements if I needed that.  Maybe in the next revision.  Hope you find this example helps you to create your own reusable forms and to tweak the decorators yourself.
</p>

        </div>
            </article>
    <nav>
        <a href="/page/123">Newer Posts</a><br />
        <a href="/page/125">Older Posts</a><br />
    </nav>
                </div>
                <div class="span4 sidebar">
                    <div class="well">
                        <h4>@TheKeyboard <small>The ramblings of a grumpy programmer</small></h4>
                    </div>
                    <div class="well sidebar-nav">
                        <h4>Links</h4>
                        <ul class="nav">
                            <li><a href="http://sculpin.io">sculpin.io</a></li>
                            <li><a href="http://twitter.com/getsculpin">@getsculpin</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <footer class="container">
            &copy; 2014 @TheKeyboard
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/components/jquery/jquery.min.js"><\/script>')</script>
        <script src="/components/bootstrap/js/bootstrap.min.js"></script>
                
                <script src="/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
