<!DOCTYPE html>
<html>
    <head>
        <title>Home &mdash; @TheKeyboard &mdash; The ramblings of a grumpy programmer</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/components/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
        <link href="/css/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="stylesheet" href="/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="@TheKeyboard activity feed" />
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
        </style>
    </head>
    <body>
        <header>
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="/">@TheKeyboard</a>
                        <div class="nav-collapse collapse">
                            <ul class="nav">
                                <li><a href="/blog">Posts Archive</a></li>
                                <li><a href="/blog/categories">Categories</a></li>
                                <li><a href="/blog/tags">Tags</a></li>
                                <li><a href="/about">About</a></li>
                            </ul>
                        </div><!--/.nav-collapse -->
                    </div>
                </div>
            </div>
        </header>
        <div class="mainContent container">
            <div class="row-fluid">
                <div class="span8">
                        <article>
        <header>
            <h2><a href="/_posts/2009-05-21-laziness-vs-efficiency.markdown"></a></h2>
        </header>
        <div>
            <hr />

<p>layout: post</p>

<h2>title: Laziness vs. Efficiency</h2>

<p>Joel Moss (a fellow member of the CakePHP community) has been acting like a bit of a Rails (and Ruby) fanboi as of late.  He's doing a series of blog posts proclaiming his <a href="http://developingwithstyle.com/2009/05/20/10-reasons-why-ruby-is-better-than-php-reason-1/">love for Ruby</a>.  Personally, I loved Rails when I first encountered it.  Played around with it.  Wrote a web site for my simulation baseball league in it.  Then started disliking *some* of the people in the community and are now pretty much ambivalent about Ruby and Rails in general.  Great tool, not for me.  Python seems to be a better fit for me at least.</p>

<p>
I think a lot of what he says is nonsense and can be summarized with "I don't like PHP's syntax."  Hell, I don't even like it myself.  PHP's big problem has been consistency with parameter order and a less-than-stellar object implementation.  Yes, things have improved in terms of OOP (closures and traits!) but PHP clings hard to it's procedural roots and that is not necessarily a bad thing.  Slamming PHP for it's OO implementation is like picking at a scab so it never goes away.  Pointless.  "PHP sucks because of bad syntax" is an argument I'd expect from my 9 year-old daughter, not a good programmer like Joel.  Kind of disappointing.  Never mind all the awesome built-in functions or wealth of high-quality third-party libraries out there for PHP.  Sure, those things exist for Ruby too but often you only have one or two choices.  PHP is absolutely rich in choices of third-party libraries.  Sure, a lot of them are not top quality but it never takes long to figure that out.  Okay, I'm drifting.  On to the rest of my point.
</p>

<p>
 I think where Joel starts to go off the rails was a follow-up in Twitter that said "Hands up if you're a lazy developer. [I proudly hold both my hands up high in the sky] Laziness makes me a better coder http://bit.ly/MKFQe".   Once and for all, we need to stamp out the "laziness makes me a better coder" meme that is picking up steam.  There is a HUGE difference between laziness defined as "I want to write less code" and laziness defined as "I don't want to have to figure shit out.".  The first one is called efficiency, not laziness.  The second one is the type of trait that a programmer should be ashamed to have.
</p>

<p>
I realize now that reliance on the use of frameworks for your applications is the type of laziness that is straying from efficiency to pure laziness.  Before you get all riled up, hear (read?) me out.  When you use a framework, you are accepting that it will be abstracting a lot of functionality away.  Functionality that you might not even understand correctly.  Which is great for quickly building something, but bad when you run into an error being generated by the framework itself.  Or behaviour that is unexpected. I like to call this "fighting against the conventions", and I believe that is the #1 reason why people end up not using a particular framework.  They cannot or are unwilling to follow the conventions and as a result, nothing will work.</p>

<p>
So, if you use a framework all the time, you might find that certain skills or bits of knowledge start to erode.  Use an ORM all the time?  You forget how to make finely tuned SQL queries.  Rely on built-in form validation?  You start to forget what POST requests look like.  Use the Ajax helper that comes with the framework?  You forget how to make tight, customized Javascript code.  I think you're starting to get the point.
</p>

<p>
Joel is 100% correct when he talks about that there are features in Ruby that allow you to be more EFFICIENT with your code than in PHP.  That is not laziness.  Usually when a developer calls themselves lazy, it is a self-deprecating statement.  I have called myself "lazy" because I strive to write as little code as possible to accomplish a task.  That's not laziness, that's efficiency.
</p>

<p>
The use of the term "laziness in terms of coding" is just a bad one to use.  Use the proper term, which is "efficiency in terms of coding".  "Laziness in terms of coding" is cut-and-pasting code all over the place, or blind use of code examples you find on the web without understanding what they really do.
</p>

<p>
Joel, I'm happy that you are loving Ruby.  Python gives me the same fuzzy glow on those occasions when I play around with it.  But please put things in the proper prospective.  To paraphrase the Princess Bride:  "You keep using that word. I do not think it means what you think it means."
</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/_posts/2009-05-26-book-now-available-on-amazon.markdown"></a></h2>
        </header>
        <div>
            <hr />

<p>layout: post</p>

<h2>title: Book Now Available On Amazon!</h2>

<p>I received an email this evening that you can now purchase my book through Amazon.com's Marketplace!  Awesome news. Check out the link <a href="http://tinyurl.com/p5o79u">http://tinyurl.com/p5o79u</a> and be sure to add your feedback to the page if you've bought a copy.</p>

<p>(Edit: hrm, link doesn't show up on front page but shows up if you click on the link to this posting...)</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/_posts/2009-06-05-a-simple-couchdb-datasource.markdown"></a></h2>
        </header>
        <div>
            <hr />

<p>layout: post</p>

<h2>title: A Simple CouchDB Datasource</h2>

<p>
Yes, my waffling continues.  But this time it is NOT with respect to what editor to use, as <a href="http://www.vim.org">the one true editor</a> has been configured in such a way to make my life easier.  I have a personal project that I have been waffling about building in Python (first as a Django app, now maybe as a web2py app) or in CakePHP, since I would probably be most productive building out something quickly using it.
</p>

<p>
Since I'm in a CakePHP phase right now, I decided to start building out some of the components I would need to make the side project work.  One of those components is the use of <a href="http://couchdb.apache.org">CouchDB</a> as the database.  Since non-relational databases are all the hawtness right now (and <a href="http://twitter.com/janl">Jan Lehnardt</a> is such an awesome guy) I decided the best way to learn it's use is to store search results by users to my site (no hints on what I'm doing).  I figured the best way to do this was to create a CouchDB datasource, add it to my application, and then create models that would use the datasource.  
</p>

<p>
While I suggest that you visit the CouchDB website for more info on what it is and how to use it, here's a quick summary:  CouchDB is a non-relational datastore that you communicate with using views written in Javascript, and it returns any records that match your view as JSON-formatted data.  Very simple when you think of it, but also very powerful.
</p>

<p>
I must emphasize that the code is very raw and not fully tested.  Written using PHP 5.2.9 and Cake 1.2.bleeding.edge. First, the data source:
~~~
< ?php

/**
 * Datasource for connecting to CouchDB
 *
 * @author Chris Hartjes
 */
class CouchDbSource extends DataSource {
    public $description = 'CouchDB Data Source';
    public $host = 'localhost';
    public $port = 5984;
    public $error_number = null;
    public $error_message = null;
    public $headers = null;
    public $body = null;

    public function __construct($config) {
        parent::__construct($config);   

        if (!empty($this->config['host'])) {
            $this->host = $this->config['host'];    
        }

        if (!empty($this->config['port'])) {
            $this->post = $this->config['port'];
        }
    }

    public function fullTableName() {
        return false;
    }
    
    /**
     * Method that sends data to the CouchDB server
     *
     * @param $method string GET, POST, PUT or DELETE
     * @param $url string URL you are trying to send to
     * @param $post_data string optional data to be posted
     * @return string
     */
    public function send($method, $url, $post_data = NULL) {
        $s = fsockopen($this->host, $this->port, $this->error_number, $this->error_message);

        if (!$s) {
            return false;
        }

        $request = "{$method} {$url} HTTP/1.0\r\nHost: {$this->host}\r\n";

        if ($post_data) {
            $request .= "Content-Length: " . strlen($post_data) . "\r\n\r\n";   
            $request .= "{$post_data}\r\n";
        } else {
            $request .= "\r\n"; 
        }

        fwrite($s, $request);

        $response = "";

        while (!feof($s)) {
            $response .= fgets($s); 
        }

        list($this->headers, $this->body) = explode("\r\n\r\n", $response);

        return $this->body;
    }
}
?>
~~~
I warned you that it was very simple.
</p>

<p>
So, if you want to use the datasource, the first thing to do is add an entry to your APP/config/database.php file with all the pertinent configuration info:
~~~
< ?php
class DATABASE_CONFIG {

    var $couchdb = array(
        'datasource' => 'couchdb',
        'host' => 'localhost',
        'port' => 5984
    );
}
?>
~~~
<br />
CouchDB by default runs on port 5984, but like most flexible applications it lets you change that port if you need to.  That's really all the configuration info you'll need.
</p>

<p>
So next up is configuring a model to use it. 
~~~
< ?php

class Search extends AppModel {
    public $name = 'Search';
    public $useDbConfig = 'couchdb';    
    public $useTable = null;

    public function send($method, $url, $post_data = NULL) {
        return $this->getDataSource()->send($method, $url, $post_data); 
    }
}

?>
~~~
Thanks to <a href="http://twitter.com/jperras">Joel Perras</a> for helping me dig through the CakePHP internals in order to figure out the best way to get my model to speak to the datasource.  And pointing out my stupid mistake that caused CakePHP's automodel magic to bite me in the ass.
</p>

<p>
So how do you actually use this thing.  Here's an example of asking CouchDB to give you a listing of all documents available on the server:
~~~
APP/controllers/searches_controller.php
< ?php

class SearchesController extends AppController {
    public function show_all() {
        $this->layout = 'ajax';
        $response = $this->Search->send('GET', '/searches/_all_docs');
        $this->set(compact('response'));
    }
}

?>

APP/views/searches/show_all.ctp

< ?= $response ?>
~~~
</p>

<p>
In my case, the view spit out a nice string that looked like this:
~~~
{"total_rows":1,"offset":0,"rows":[ {"id":"e2ffaae4df81b66c3d8386b75be71aa3","key":"e2ffaae4df81b66c3d8386b75be71aa3","value":{"rev":"1-71594714"}} ]}
~~~
</p>

<p>
So there you have it.  If you want to do more work with this datasource, I suggest you take a look at <a href="http://wiki.apache.org/couchdb/Getting_started_with_PHP">this link on the CouchDB wiki</a> about using PHP with CakePHP.   It could use some work to add in convenience methods for adding, deleting and finding specific records but it's a good start I think.
</p>

        </div>
            </article>
    <nav>
        <a href="/page/108">Newer Posts</a><br />
        <a href="/page/110">Older Posts</a><br />
    </nav>
                </div>
                <div class="span4 sidebar">
                    <div class="well">
                        <h4>@TheKeyboard <small>The ramblings of a grumpy programmer</small></h4>
                    </div>
                    <div class="well sidebar-nav">
                        <h4>Links</h4>
                        <ul class="nav">
                            <li><a href="http://sculpin.io">sculpin.io</a></li>
                            <li><a href="http://twitter.com/getsculpin">@getsculpin</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <footer class="container">
            &copy; 2014 @TheKeyboard
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/components/jquery/jquery.min.js"><\/script>')</script>
        <script src="/components/bootstrap/js/bootstrap.min.js"></script>
                
                <script src="/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
