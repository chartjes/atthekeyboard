<!DOCTYPE html>
<html>
    <head>
        <title>Home &mdash; @TheKeyboard &mdash; The ramblings of a grumpy programmer</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/components/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
        <link href="/css/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="stylesheet" href="/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="@TheKeyboard activity feed" />
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
        </style>
    </head>
    <body>
        <header>
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="/">@TheKeyboard</a>
                        <div class="nav-collapse collapse">
                            <ul class="nav">
                                <li><a href="/blog">Posts Archive</a></li>
                                <li><a href="/blog/categories">Categories</a></li>
                                <li><a href="/blog/tags">Tags</a></li>
                                <li><a href="/about">About</a></li>
                            </ul>
                        </div><!--/.nav-collapse -->
                    </div>
                </div>
            </div>
        </header>
        <div class="mainContent container">
            <div class="row-fluid">
                <div class="span8">
                        <article>
        <header>
            <h2><a href="/blog/2013/10/26/data-providers-and-arrays">Data providers and arrays</a></h2>
        </header>
        <div>
            <p>I was asked a question on Twitter by <a href="https://twitter.com/tex_morgan">Tex Morgan</a> 
about a problem he was having with <a href="http://phpunit.de/manual/current/en/writing-tests-for-phpunit.html#writing-tests-for-phpunit.data-providers">PHPUnit data providers</a>. He was trying to pass in some data and kept wondering
why PHPUnit was serializing the data instead of doing what he was expecting.</p>

<pre><code>public function preLoaderArrayDataProvider()
{
    return array("one" =&gt;
        array(
            'http://yahoo.com',
            'http://google.com',
            'http://facebook.com',
            'http://twitter.com'
        ), "two" =&gt;
        array(
            "http://jquery.com",
            "http://jqueryui.com"
        )
    );
}

/** testSetArray
 * @dataProvider   preLoaderArrayDataProvider
 */
public function testSetArray($array)
{
    $this-&gt;expected = true;
    $this-&gt;actual = $this-&gt;object-&gt;setArray($array);
    $this-&gt;assertEquals($this-&gt;expected, $this-&gt;actual);
}
</code></pre>

<p>I see what Mr. Morgan was trying to do, and more importantly why it wasn't
working. The problem he was running into has to deal with how PHPUnit expects
data to be sent by the data providers.</p>

<p>The method under test is expecting one parameter that consists of an array.
Data providers are supposed to return an array of arrays, where each element
of the inner array maps to a parameter the method under test is expecting.</p>

<p>So what went wrong? The data provider is passing in 5 strings as a parameter.
Here's the results:</p>

<pre><code>PHPUnit 3.7.28 by Sebastian Bergmann.

FF

Time: 28 ms, Memory: 2.50Mb

There were 2 failures:

1) TexTest::testSetArray with data set "one" ('http://yahoo.com', 'http://google.com', 'http://facebook.com', 'http://twitter.com')
Failed asserting that false matches expected true.

/Users/chartjes/src/php-test-bootcamp-practice/tests/TexTest.php:29

2) TexTest::testSetArray with data set "two" ('http://jquery.com', 'http://jqueryui.com')
Failed asserting that false matches expected true.

/Users/chartjes/src/php-test-bootcamp-practice/tests/TexTest.php:29

FAILURES!
Tests: 2, Assertions: 2, Failures: 2.
</code></pre>

<p>The fix is easy. The method under tests is expecting one parameter that is an
array, so let's give it one.</p>

<pre><code>public function preLoaderArrayDataProvider()
{
    return array("one" =&gt;
        array(
            array(
                'http://yahoo.com',
                'http://google.com',
                'http://facebook.com',
                'http://twitter.com'
            )
        ), "two" =&gt;
        array(
            array(
                "http://jquery.com",
                "http://jqueryui.com"
            )
        )
    );
}
</code></pre>

<p>The result?</p>

<pre><code>PHPUnit 3.7.28 by Sebastian Bergmann.

..

Time: 17 ms, Memory: 2.25Mb

OK (2 tests, 2 assertions)
</code></pre>

<p>Problem solved. Hope this helps you give a better understanding of how
PHPUnit data providers work.</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/blog/2013/10/14/booze-babes-and-buttholes">Booze, babes, and buttholes</a></h2>
        </header>
        <div>
            <p>If you follow me online at all you are probably aware that I help organize
<a href="http://truenorthphp.ca">TrueNorthPHP</a>, a PHP-centric conference for developers.
This is the second time I've helped out, and I have been watching with a mixture
of horror and fear how social media networks are filling up with tales of
excessive alcohol consumption and sexual assaults of female attendees at
conferences.</p>

<p>I know people hate talking about this sort of stuff, but I am keenly aware
of the ridiculous amount of privilege I have in this society. White, male,
over 40, heterosexual, married, well-paid, working in technology. Some of
this has been earned, much of it just handed to me.</p>

<p>As I briefly <a href="https://twitter.com/grmpyprogrammer/status/389825655460073472">mentioned on Twitter</a>
my goal is to try and create an environment where people can meet and find
common ground. Sure, there will always be assholes who wreck if for you.
Sometimes those assholes are the conference organizers themselves. Ultimately,
the responsibility for the attendees feeling wanted, engaged and safe belongs
to the organizers.</p>

<p>As I see it, there are two major concerns for a conference organizer in late
2013: too much alcohol makes people uncomfortable, and harassment of women
by attendees. I wanted to share my thoughts on both.</p>

<p>I intend on enforcing a zero-tolerance-for-bullshit-behaviour policy at the conference.
This includes harassing people based on gender, sexual preference, country of
origin. In short, if you act like an asshole and I find out, chances are you
will be escorted out personally with no refund. It's not hard to avoid acting
in an unacceptable way, and never mind your own incorrect opinions on free
speech and the consequences that come with it.</p>

<p>It's a shame that I have to say things like this to other adults, because I 
would prefer to trust people to know what is acceptable in such an environment.</p>

<p>Second, clearly, there is an alcohol problem in general at conferences. There
is a huge cultural component to it (bros want to slam down the brewskis) and
many people who do not drink alcohol (for whatever reason) are made to feel
uncomfortable with not drinking it. The cheers when people hear that there
is an open bar, the jokes about people not attending talks on the second day
because they are hungover. I could go on, but I think you get the idea.</p>

<p>In a culture where drinking, often to excess, is acceptable to a large percentage
of the population, this is very tough battle. Personally, I am looking to offer
free alcohol at the conference but in very limited amounts. The conference venue
doesn't allow any on-site alcohol so your only chance to have a drink on me 
is at our party on the Saturday. Which is at a bar near the venue.</p>

<p>If you don't drink alcohol, come and sit with me at the restaurant and I will
make sure you are welcomed and not uncomfortable. I don't need to drink alcohol to
socialize with my friends and peers, and neither will you. Being with a bunch
of strangers is intimidating enough without feeling pressure to conform.</p>

<p>Third, people still have the attitude that computer programming should be one
big sausage party. Women are expected to "know their place" and go along
with all the crude humour and intimidating behaviour that those who think
women are inferior are supposed to just endure with a smile. When I see
comments like "you're encroaching on a safe place for males" it makes me
want to physically confront them about their incredibly wrong ideas.</p>

<p>I worked hard to attract women speakers who would provide interesting content
to my conference. Did things go as well as I thought they could? No, it never
does. I could've worked harder to seek out more talented women speakers, but
there is only so much time and the list of things a conference organizer
has to think about is long.</p>

<p>Any female attendees for TrueNorth can feel comforted that I will be 100%
approachable and 100% on your side should you be subject to any objectionable
behaviour by any attendee. As the father of two girls, I already see the 
bullshit they are being asked to put up with simply because of their gender.
I won't go along with letting it happen to you.</p>

<p>If you come to our Saturday social and are feeling uncomfortable, again, join
me at my table and I will work my hardest to make sure you are as comfortable
as I will be.</p>

<p>Last year, the conference was awesome and I didn't hear any complaints. That
doesn't mean things didn't happen, and part of me wonders if many suffered in
silence because they thought complaining wouldn't change anything.</p>

<p>I want you to enjoy yourselves at TrueNorthPHP, with an
understanding that binge-drinking and harassment of attendees is something
that will absolutely not be tolerated or promoted by the organizers.</p>

<p>The goal is to spend 2 days learning and sharing things about PHP and related
technologies, while also having a good time in an environment where you should
expect to be looked after and feel safe.</p>

<p>Don't hesitate to track me down and ask me about ANYTHING while at the 
conference. I am here to help you.</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/blog/2013/09/27/test-listeners">Testing Listeners</a></h2>
        </header>
        <div>
            <p>I had an idea to put together some kind of "PHP Testing Koans" site as a way
to help PHP developers get better at learning how to actually write tests. Most
developers who are introduced to testing get blocked at the point of actually
writing a test. This, in my opinion, has been part of my advocacy that I 
have been struggling to find a good way to teach to people.</p>

<p>So I started to brainstorm ways to make it happen. With some help from <a href="https://twitter.com/jclermont">Joel Clermont</a>
I stumbled upon using test listeners for this.</p>

<p>To be completely fair, I first ran across test listeners when <a href="https://twitter.com/old_sound">Alvfaro Videla</a>
showed me a blog post he had written on how to <a href="http://videlalvaro.github.io/2013/04/using-rabbitmq-in-unit-tests.html">write unit tests for RabbitMQ</a>.
It's a very imaginative use of them, so I wondered if I could bend those test
listeners to my will.</p>

<p>From a high-level view, test listeners in PHPUnit are bits of code designed
to be executed whenever a test suite or individual test is run. For the example
of dealing with RabbitMQ, this makes total sense.</p>

<p>Imagine how happy I was to find that I could use it to determine if a particular
test existed. So how did I do it?</p>

<pre><code>&lt;?php

class Koan1Listener extends PHPUnit_Util_Printer implements PHPUnit_Framework_TestListener
{
    private $expected_tests = array();
    private $found_tests = array();

    public function __construct()
    {
        $this-&gt;expected_tests = array('testHelloWorld');
    }

    public function __destruct()
    {}

    public function startTestSuite(PHPUnit_Framework_TestSUite $suite)
    {
    }

    public function endTestSuite(PHPUnit_Framework_TestSuite $suite)
    {
        foreach ($this-&gt;expected_tests as $test) {
            if (!in_array($test, $this-&gt;found_tests)) {
                throw new Exception("Missing test {$test}");
            }
        }
    }

    public function addError(PHPUnit_Framework_Test $test, Exception $e, $time)
    {}

    public function addFailure(PHPUnit_Framework_Test $test, PHPUnit_Framework_AssertionFailedError $e, $time)
    {}

    public function addIncompleteTest(PHPUnit_Framework_Test $test, Exception $e, $time)
    {}

    public function addSkippedTest(PHPUnit_Framework_Test $test, Exception $e, $time)
    {}

    public function startTest(PHPUnit_Framework_Test $test)
    {
        $test_names = get_class_methods($test);

        foreach ($test_names as $test_name) {
            $this-&gt;found_tests[] = $test_name;
        }
    }

    public function endTest(PHPUnit_Framework_Test $test, $time)
    {}
}

</code></pre>

<p>When you create a listener, you are implementing all the required methods
for <em>PHPUnit_Framework_TestListener</em>. You can see that there are a lot of
them, but in this instance all we needed were <em>endTestSuite</em> and <em>startTest</em>.</p>

<p>The approach is simple: for each test class that gets executed, add the names
of all the methods to an internal list. When the entire test suite is finished,
we then check to see if the test names that we were expecting are in our
list of methods we found. I am sure there is a more efficient way to do it, 
so let me know in the comments of a different approach.</p>

<p>In the case of the example listener, I wanted to make sure that the person
doing the first exercise has a test called <em>testHelloWorld</em> written. As more
koans (or whatever you want to call them) get created, I can use test listeners
to make sure that all the tests, and data providers, and internal class methods
designed to improve code reuse are actually getting written.</p>

<p>Despite all my years of using these tools, I still find things that I didn't 
know about that can be (ab)used to accomplish certain goals.</p>

<p>I hope you find that something you thought you couldn't figure out becomes
possible using test listeners.</p>

        </div>
            </article>
    <nav>
        <a href="/page/141">Newer Posts</a><br />
        <a href="/page/143">Older Posts</a><br />
    </nav>
                </div>
                <div class="span4 sidebar">
                    <div class="well">
                        <h4>@TheKeyboard <small>The ramblings of a grumpy programmer</small></h4>
                    </div>
                    <div class="well sidebar-nav">
                        <h4>Links</h4>
                        <ul class="nav">
                            <li><a href="http://sculpin.io">sculpin.io</a></li>
                            <li><a href="http://twitter.com/getsculpin">@getsculpin</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <footer class="container">
            &copy; 2014 @TheKeyboard
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/components/jquery/jquery.min.js"><\/script>')</script>
        <script src="/components/bootstrap/js/bootstrap.min.js"></script>
                
                <script src="/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
