<!DOCTYPE html>
<html>
    <head>
        <title>Home &mdash; @TheKeyboard &mdash; The ramblings of a grumpy programmer</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/components/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
        <link href="/css/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="stylesheet" href="/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="@TheKeyboard activity feed" />
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
        </style>
    </head>
    <body>
        <header>
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="/">@TheKeyboard</a>
                        <div class="nav-collapse collapse">
                            <ul class="nav">
                                <li><a href="/blog">Posts Archive</a></li>
                                <li><a href="/blog/categories">Categories</a></li>
                                <li><a href="/blog/tags">Tags</a></li>
                                <li><a href="/about">About</a></li>
                            </ul>
                        </div><!--/.nav-collapse -->
                    </div>
                </div>
            </div>
        </header>
        <div class="mainContent container">
            <div class="row-fluid">
                <div class="span8">
                        <article>
        <header>
            <h2><a href="/_posts/2009-02-10-rebuilding-your-programming-and-deployment-environments.markdown"></a></h2>
        </header>
        <div>
            <hr />

<p>layout: post</p>

<h2>title: Rebuilding Your Programming And Deployment Environments</h2>

<p>As I get closer to giving my deployment talk at the <a href="http://conf.phpquebec.com/en/">2009 PHP Quebec Conference</a> (you're going, right?) I've been paying close attention to what sort of things people have been doing in terms of best practices and actual application deployment.  Looking at some of these things, I realize how lax I've gotten lately.  Is it the crushing ennui of ongoing, incremental programming by a lone developer for his employer?  I'm being sarcastic (obviously) but the more I think about HOW I've been doing the development work the more I realize that I need to refocus.  
</p>

<p>
So, my programming environment appears somewhat sane to me.  I write my code using <a href="http://www.vim.org">the One True Editor(tm)</a> on my laptop, where I've installed PHP, Python and Perl.  Since I work with both MySQL and Postgres, they are both on my laptop as well.  Is it any wonder I've crammed my MacBook with 4 GB of RAM?  I typically have a few Terminal.app instances running and a couple of <a href="http://code.google.com/p/mavcim">MacVim</a> instances.  I find that I use <a href="http://www.sequelpro.com/">Sequel Pro</a> and <a href="http://www.pgadmin.org/">pgAdmin III</a> a lot, as all that work with sports data requires large queries that I have to tweak little by little.
</p>

<p>
I also have found a powerful tool that I always ignored, but has been a godsend for development work.  What do you do when you have a large data set that your application needs to work against and it is totally impractical to copy it locally?  SSH tunneling to the rescue! 
<pre>
ssh -fNg -L3308:localhost:3306 notchris@rangers.xmlteam.com
</pre>
That creates a tunnel to the MySQL server on one of our production machines (we name them after NHL teams), which I then can access by making a MySQL connection on port 3308.   Very simple and VERY effective.  I can't believe I had forgotten about this.  This technique works well when using something like Sequel Pro, and we had an SQL consultant in who connected the same way.
</p>

<p>
But now we're onto the toughest part of tearing down and rebuilding.  As our products (both the web ones and our main project, a Perl-based data-fetching-and-parse-into-a-db application) get more complicated it becomes obvious to me that my suspicions about there not being enough testing in place are unfortunately coming true.  So now is the time where this lone developer has to start thinking like he is part of a team and push forward with a new strategy, <a href="http://en.wikipedia.org/wiki/Test_driven_development">TDD</a>.
</p>

<p>
I'm positive I've talked about this before on this very blog.  Code Igniter's testing absolutely sucks out of the box.  Luckily I have my CI-to-<a href="http://www.phpunit.de/">PHPUnit</a> bridge.  <a href="http://sebastian-bergmann.de/">Sebastian</a>, I owe you a bunch of alcoholic-beverages-of-your-choice when I run into you in Montreal in March for all you've done with PHPUnit.  So now I begin the incredibly daunting task of shoehorning in tests for an application that doesn't have any.  But that's not where the problem starts.
</p>

<p>
See, I'm having problems deciding WHAT to test.  Let's take a look at one project for example.  We have <a href="http://www.sportsdb.org/sd/sportscaster">self-hosted web service</a> that we released under the  GPL that we not only use ourselves for some clients but also use it to troubleshoot things as well.  In terms of writing tests, I believe the best way to approach this is to write tests that speak directly to the Sportscaster "engine" using a known set of parameters and ensure that the output we get back matches what we expect.  Is unit testing overkill for this?  Very hard to say because we have an HTML front end that talks to a "gateway" that talks to an "engine".  I'm not the one who architected this, but I do have to make sure that it works properly.  In this case I believe that  "your tests should verify your application is outputting what you expect it to" is the best approach.  Comments about this are totally welcome.
</p>

<p>
For another project, I tried something that <a href="http://sebastian-bergmann.de/archives/631-Integrating-PHPUnit-with-Selenium.html">integrated Selenium with PHPUnit</a>, but it was so slow as to be totally useless.  <a href="http://www.sportso.com">Sportso</a> is a very visual application, one that is written in PHP an talks to an <a href="http://exist.sourceforge.net">XML database</a>, but presentation is really the key here.  Sure, we need to make sure that we're placing the right data into our XML documents but that part of the application is solid.  In this case, I wish to have tests that simulate a user clicking around the application and using it.  Then I can compare output again and make sure that things are showing up when and where I expect them to.  I'm thinking the PHPUnit-Selenium bridge is a bad idea, and that I should instead just focus on Selenium.  Again, comments on how to best approach this are also welcome.  I cannot believe that Selenium is really this slow, so there must be something I am doing wrong.
</p>

<p>
Also, I've thought about continuous integration.  This <a href="http://timothyfitz.wordpress.com/2009/02/10/continuous-deployment-at-imvu-doing-the-impossible-fifty-times-a-day/">incredibly inspiring post about continuous deployment</a> has me really thinking hard about how my changes actually get pushed up out of dev to production.  We don't have the resources to use a cluster of machines that IMVU appears to have, but when you think of the infrastructure and (more importantly) the practices in place, you just have to be in awe of it all.  Just the *scale* of it is inspiring.  If they can do this, I can certainly implement a very effective subset of this.  There is really no reason other than laziness on my part to not do it.  Harsh reality, to be sure.
</p>

<p>
But the real problem is the political game that you inevitably end up fighting over bring in what is usually a very radical concept:  a commitment to testing as part of the development process.  Especially when the developers are severely outnumbered.  A lot of people seem to have a pathological fear of automated testing, saying things like "we can just quickly test it by hand".  Then when you see the errors being reported by users of your products, you can't help but wonder "could we have caught this earlier?"  Unless it's a very obscure error involving a race condition or something, of course the answer is YES.
</p>

<p>
I read a post from one of the main developers at justin.tv talking about why he felt <a href="http://abstractstuff.livejournal.com/60388.html">unit testing is useless</a>.  While he is entitled to his opinion  I can't help but think that he really is doing TDD, but he just refuses to acknowledge it.  Yes, ultimately, your users are the only ones who can tell you if your application is spitting out errors.  But if you aren't doing any rigourous testing of stuff BEFORE your users see it, I think you are taking chances with your business.  My company is small (just 7 of us) so I'm so close to most aspects of the business I can really see the impact of certain decisions on the bottom line of the company.  It's not about finding bugs, which is what is being claimed by the justin.tv folks never happens with unit testing.  It's about making sure those bugs never happen in the first place.
</p>

<p>
I have to say that I've never really delved into the world of post-deployment monitoring, so maybe I should start asking a few more questions of people who deal with that sort of thing.  Again, the key is to make it automated and have it report when it finds things that are wrong.  We have a very good nagios infrastructure at work that alerts us to problems with not only servers being down, but stale and/or missing data for our customers.  I guess the next logical step is figuring out ways to look at those mountain of server logs and making sense of the errors?  Definitely something to think about the next time I get stuck on some programming problem at work and need a change of pace.
</p>

<p>
I know I've been rambling a bit here, so let me pull some of this stuff back together to make it more cohesive:
<ul>
<li>SSH tunneling to access resources that you cannot easily put a snapshot of into your work environment.  I recommend read-only access if you can do it, because if you need to do updates or deletes you should always work off a local copy</li>
<li>TDD is a powerful yet still controversial tool that too many developers are still ignoring (including me, but it's not too late to save myself!)</li>
<li>Automation is the key to really taking advantage of what you gain by going with TDD</li>
<li>You need tools in place after deployment to see if your changes have had the desired effect</li>
</ul>
</p>

<p>
As always, bombard me in the comments with your thoughts and experiences with these types of scenarios.  I hope I don't get too many <a href="http://www.urbandictionary.com/define.php?term=tl%3Bdr">tl;dr</a> responses.
</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/_posts/2009-02-18-chris-brain-2009-02-18.markdown"></a></h2>
        </header>
        <div>
            <hr />

<p>layout: post</p>

<h2>title: Chris' Brain - 2009-02-18</h2>

<p>
<i>Book is getting close</i><br />
Circle March 9 on your calendar, as that is the day my book "Refactoring Legacy Applications Using CakePHP" as the day it will be released.  I will be offering a PDF version and a print-on-demand version via Lulu.com.  It looks like the PDF with be $10 or less, with the price of the POD version being at least double that.  More details once I get the site for this up-and-running.
</p>

<p>
<i>Book Review On The Run</i><br />
On the recommendation of <a href="http://twitter.com/lstrojny">someone I follow on Twitter</a> I ordered a copy of "Beautiful Architecture", a collection of essays and articles published by O'Reilly and edited by Diomidis Spinellis & George Gousios.  It's all about software architecture and so far it's been an awesome read.  For anyone who's ever been in a position to have a say about not just WHAT they are building but HOW they build it, it's a great read.  I'm about halfway through.
</p>

<p>
<i>Frameworks expand to fill available space</i><br />
I was thinking about this the other day.  All frameworks start out being lightweight, unless your original design calls for you to be full-stack and bundle everything including a small web server for testing.  Then, as the project matures you keep adding things to it and before you know it you are just as big and close to being full-stack as everyone else.   So to those that call certain frameworks bloated, reconsider your position and take into account what YOU add to an application built with that framework that is not already in there.
</p>

<p>
<i>7 Habits for Effective Text Editing 2.0</i><br />
Even if you don't use <a href="http://www.vim.org">the One True Editor</a>, check out this video with the creator of Vim as he talks about <a href="http://video.google.com/videoplay?docid=2538831956647446078">being more efficient when working with text.</a>  The strategies he talks about work with ANY editor / IDE and that's really the point.
</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/_posts/2009-02-25-ad-hoc-web-testing-using-python.markdown"></a></h2>
        </header>
        <div>
            <hr />

<p>layout: post</p>

<h2>title: Ad-hoc Web Testing using Python</h2>

<p>
"But Chris, I thought you were a PHP guy?"  Yes, in my day-to-day work I use a lot of PHP.  However, I am branching out as required by my desire to learn new things.  One of those new things is <a href="http://www.python.org">Python</a>, both on the web and the server side.  I thought I would share with you a tool I whipped together to do some testing of webservices at work built using <a href="http://www.sportsdb.org/sd/sportscaster">an application front-end that we have released under the GPL</a>.  Of course, you need to be using our non-free sports data feed fetching software, but that's not the point.
</p>

<p>
So, as of March 1 we are turning off an old server that uses an older, Perl-using-CGI web service and redirecting those customers using it to one built using PHP (Code Igniter specifically.  Again, this decision was made before I started at that job.)  As the lead engineer on the project (okay, the only one) I had to make sure that all the old queries would work on the new server.  When my boss told me to "manually check them" I scoffed and said "manual checking is for suckers, I'm going to write a script to do it.".
</p>

<p>
The methodology is as follows:
<ol>
<li>Make sure that calls to the old web service return properly formed XML *or* HTML with a certain string  in it when we are doing XSLT transforms</li>
<li>Do the same thing with the new web service</li>
<li>Tell me when something isn't right</li>
</ol>
</p>

<p>
I could do more work in this script, to do things like look for certain tags in the XML document to be populated but we can skip that for now.  The new web service has been tested quite well and we are getting back results as expected via some other tests I've written using PHPUnit.</p>

<p>
With help from <a href="http://diveintopython.org/">Dive Into Python</a> and some judicious searching on Google, I came up with this script.  As far as I can tell, the only outside dependency was me using <a href="http://www.crummy.com/software/BeautifulSoup/">Beautiful Soup</a> to read in the HTML output.  Maybe I could've used Beautiful Soup for both the XML and HTML, but this still works just fine.
</p>

<pre><code>#!/usr/bin/python 

import urllib2
from xml.dom import minidom
import fileinput
from BeautifulSoup import BeautifulSoup

host = 'http://w04.foo.com';
host2 = 'http://w05.foo.com';
users = ["foo", "bar", "baz", "alpha", "omega"] 
passwords = ['xxxxx', 'xxxxxx', 'xxxxxx', 'xxxxx', "xxxxx"]
key = 0

for username in users:
    print "Doing check for " + username
    password = passwords[key]
    password_mgr = urllib2.HTTPPasswordMgrWithDefaultRealm()
    password_mgr.add_password(None, host, username, password)
    handler = urllib2.HTTPBasicAuthHandler(password_mgr)
    opener = urllib2.build_opener(handler)
    urllib2.install_opener(opener)
    password_mgr.add_password(None, host2, username, password)
    handler = urllib2.HTTPBasicAuthHandler(password_mgr)
    opener2 = urllib2.build_opener(handler)
    urllib2.install_opener(opener2)

    for line in fileinput.input(username + "_url.txt"):
        try:
            data = urllib2.urlopen(line)

            try:
                xmldoc1 = minidom.parse(data)
            except:
                html = urllib2.urlopen(line).read()
                soup = BeautifulSoup(html)

                if not soup.find(text="XML Team Solutions"):
                    print "Bad XML+HTML:" + line

        except:
            print "Could not load " + line

    key = key + 1
</code></pre>

<p>
URL's that I wished to test were stored in text files that this script then read in.  Using a little grep + awk magic I was able to extract URL's from our web server access log in order to test.  I'd appreciate any tips from Pythonistas out there on how to make this code conform more to the "Python way" if there is such a thing.
</p>

        </div>
            </article>
    <nav>
        <a href="/page/103">Newer Posts</a><br />
        <a href="/page/105">Older Posts</a><br />
    </nav>
                </div>
                <div class="span4 sidebar">
                    <div class="well">
                        <h4>@TheKeyboard <small>The ramblings of a grumpy programmer</small></h4>
                    </div>
                    <div class="well sidebar-nav">
                        <h4>Links</h4>
                        <ul class="nav">
                            <li><a href="http://sculpin.io">sculpin.io</a></li>
                            <li><a href="http://twitter.com/getsculpin">@getsculpin</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <footer class="container">
            &copy; 2014 @TheKeyboard
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/components/jquery/jquery.min.js"><\/script>')</script>
        <script src="/components/bootstrap/js/bootstrap.min.js"></script>
                
                <script src="/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
