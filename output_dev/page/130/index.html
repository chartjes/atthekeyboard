<!DOCTYPE html>
<html>
    <head>
        <title>Home &mdash; @TheKeyboard &mdash; The ramblings of a grumpy programmer</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/components/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
        <link href="/css/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="stylesheet" href="/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="@TheKeyboard activity feed" />
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
        </style>
    </head>
    <body>
        <header>
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="/">@TheKeyboard</a>
                        <div class="nav-collapse collapse">
                            <ul class="nav">
                                <li><a href="/blog">Posts Archive</a></li>
                                <li><a href="/blog/categories">Categories</a></li>
                                <li><a href="/blog/tags">Tags</a></li>
                                <li><a href="/about">About</a></li>
                            </ul>
                        </div><!--/.nav-collapse -->
                    </div>
                </div>
            </div>
        </header>
        <div class="mainContent container">
            <div class="row-fluid">
                <div class="span8">
                        <article>
        <header>
            <h2><a href="/_posts/2010-05-28-essential-programming-books-building-scalable-web-site.markdown"></a></h2>
        </header>
        <div>
            <hr />

<p>layout: post</p>

<h2>title: "Essential Programming Books: \"Building Scalable Web Sites\""</h2>

<p>Like many old sk00l developers, I like the security blanket a bookshelf full of technical books gives me.  Whenever I have a problem, I check to see if I can figure it out using the reference materials on hand.  Just looking at my shelves.  Since She Who Must Be Obeyed Around Here frowns on boxes constantly showing up at our house from various online book retailers, I usually only purchase books that I think are going to be good additions to the library.</p>

<p>
Taking a quick peek at my bookcase, these are a few of the books that I consider essential reference guides for me:
<ul>
<li>The Pragmatic Programmer</li>
<li>Practices of an Agile Developer</li>
<li>Mastering Regular Expressions
</li><li>Beautiful Code / Beautiful Architecture</li>
<li>Javascript: The Good Parts</li>
</ul>
I have more books, but those are the ones closest to my desk.
</p>

<p>
There is now a new book that has earned a spot on my bookcase, and should be in one of the slots closest to my desk.  I am reading a borrowed copy of it, but I plan on rectifying that soon.  "Building Scalable Web Sites" by Cal Henderson (he of Flickr and <a href="http://www.youtube.com/watch?v=i6Fr65PFqfk">"Why I Hate Django</a> fame) is that book.
</p>

<p>
I don't know how I can describe how awesome this book is in this blog.  Just check out the topics in the table of contents:
<ol>
<li>Introduction</li>
<li>Web Application Architecture</li>
<li>Development Environment</li>
<li>i18n, L10n, and Unicode</li>
<li>Data Integrity and Security</li>
<li>Email</li>
<li>Remote Services</li>
<li>Bottlenecks</li>
<li>Scaling Web Applications</li>
<li>Statistics, Monitoring, and Alerting</li>
<li>APIs</li>
</ol>
</p>

<p>Pardon my vulgarity, but that is pretty much every single fucking thing you need to worry about when building a web site that is going to be used by anyone other than you and your close circle of friends.
</p>

<p>
This book is old in internet time:  published in 2006, meaning it was probably written in 2004-2005.  A lot of technology has changed, but the principles themselves have not.  Also, a lot of the code inside uses PHP for it's examples, but I really think this applies to any programming language that is stateless and/or promotes a "shared nothing" architecture.  That means (as far as I'm concerned) PHP, Python and Ruby.  It's very simple:  scaling anything is difficult, but scaling something where there is information that needs to be shared between nodes is extremely difficult.   The best way to use this book is to ignore the specific technologies being mentioned and focus on the ideas and practices that are being promoted.  I mean, let's be brutally honest:  Cal Henderson helped build one of the most massively scaled web sites, using a programming language at it's core that the hipster programmer crowd sneers at.  Ignore his advice at your peril.
</p>

<p>
Go buy this book.  Right now.  You will not regret it.
</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/_posts/2010-06-03-testing-controllers-hiding-behind-zend_auth.markdown"></a></h2>
        </header>
        <div>
            <hr />

<p>layout: post</p>

<h2>title: Testing Controllers Hiding Behind Zend_Auth</h2>

<p>(Note, this example was using Zend Framework 1.10, so things might change going forwards).</p>

<p>As a lapsed tester, I've made the commitment to build out our Zend Framework powered application using tests going forward.  The first two modules for the app *should* have been done with tests, and for that I hang my head with shame.  Now that I've invested the work in creating a <a href="http://en.wikipedia.org/wiki/Continuous_integration">continuous integration</a> environment using <a href="http://hudson-ci.org">Hudson</a>, there is no longer an excuse to not write tests.  Especially when I can get tests run automatically every time I commit code.
</p>

<p>
Anyway, I was asked to implement a new feature for the application:  a list of all transactions for a fantasy baseball league, sorted by date.  What a perfect excuse to write some tests!  The initial problem though was how do I simulate logging in a user so I can see this page, which was protected by authentication using Zend_Auth.  So I started my scouring the internet for answers.
</p>

<p>
I found quite a few examples on how to test a controller, using the $this->dispatch('/path/to/action') method but found that I wasn't getting redirected properly to the post-login page.  I was passing proper credentials in and everything.  Then finally after deciding to go back to basics and read up on just how to test Zend_Auth.  After some swearing a few face-palms, I realized what I had been doing wrong.
</p>

<p>
The tl;dr version:  I was forgetting that the unit test itself needed to manually log in the user by speaking with Zend_Auth directly.  Here's the testing code for that particular controller:
~~~
< ?php

require_once 'Zend/Test/PHPUnit/ControllerTestCase.php';
require_once 'Zend/Application.php';

// Define path to application directory
if (!defined('APPLICATION_PATH')) {
    define('APPLICATION_PATH', realpath(dirname(__FILE__) . '/../../../application'));
}

// Define application environment
if (!defined('APPLICATION_ENV')) {
    define('APPLICATION_ENV', (getenv('APPLICATION_ENV') ? getenv('APPLICATION_ENV') : 'test'));
}

// Ensure library/ is on include_path
set_include_path(implode(PATH_SEPARATOR, array(
        realpath(APPLICATION_PATH . '/../library'),
            get_include_path(),
        )));

class TransactionControllerTest extends Zend_Test_PHPUnit_ControllerTestCase 
{

    public function setUp()
    {
        $this->bootstrap = new Zend_Application(
            'testing',
            APPLICATION_PATH . '/configs/application.ini'
        );
        parent::setUp();
    }

    public function loginUser($login, $passwd, $shortLeague)
    {
        $authParams = array(
            'login' => $login,
            'password' => $passwd,
            'short_league' => $shortLeague 
        );
        $adapter = new Xmlteam_Auth($authParams);
        $auth = Zend_Auth::getInstance();
        $result = $auth->authenticate($adapter);
        $this->assertTrue($auth->hasIdentity());
    }

    public function tearDown()
    {
        parent::tearDown();
    }

    public function testOverallBaseballList()
    {
        $this->loginUser('test@test.com', '*****', 'bluejays2010');
        $this->dispatch('/baseball/bluejays2010/transactions/list');
        $this->assertModule('baseball', 'In baseball module');
        $this->assertController('transactions', 'In the transactions controller');
        $this->assertQuery('#tblTransactions', 'Transaction table exists');
    }
}
~~~
</p>

<p>
I'm using a custom authentication adaptor with Zend_Auth, as we need to limit access for a user to a particular league.  Perhaps better to do it with Zend_Acl, and since the platform is likely to expand I will end up using that as well.  But I am drifting off topic here.
</p>

<p>
The magic is in that loginUser() method.  What I did not realize at the time was that running a test where I asked it to dispatch users to the login page and passed along what would've been entered in the form was not working.  Perhaps it was creating an authenticated session OUTSIDE the scope of the test environment.  Perhaps it is my sucky code.  Either way, it wasn't working.
</p>

<p>
So, by creating a authenticated login Zend_Auth *inside* the test, I could then safely dispatch my testing code to look at pages requiring authentication.  I hope this blog posts helps out others trying to write tests for controllers that are hidden behind Zend_Auth.
</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/_posts/2010-06-16-book-review-codeigniter-1-7-professional-development.markdown"></a></h2>
        </header>
        <div>
            <hr />

<p>layout: post</p>

<h2>title: "Book Review - CodeIgniter 1.7: Professional Development"</h2>

<p>The folks at Packt Publishing asked if I was interested in reviewing their upcoming title <a href="https://www.packtpub.com/codeigniter-1-7-professional-development/book">"CodeIgniter 1.7: Professional Development"</a> due to my experience with CodeIgniter.  While it is not my favourite framework (for reasons that I have explained on this blog), I still have to work with it going forward.  I was interested to see what direction such a book would take.  After going through it, I was happily surprised.
</p>

<p>
When I read a book about a programming framework, I'm expecting to see that they start off with the basics of using the framework, then keep expanding on the abilities of the framework.  By the end of the book, you should be able to build something OTHER than the example application (if they provide one).  I mean, if I just want a list of functions then I will hit up Google/Bing/Duck Duck Go to find the info I want.  This book starts with the basics of the framework, and patiently builds on the concepts you previously learned.  Good, clear examples of how to do things.  
</p>

<p>
I thought another nice touch was the expanding into concepts like scaling the application, and extending the framework itself.  If there is one thing I've learned building web apps over the years, it's that you (a) inevitably need to worry about scaling the application and (b) you end up having to make your own modifications to the framework itself to meet unique challenges for the application.
</p>

<p>
All in all, I recommend this book to anyone who is planning on using CodeIgniter 1.7 (and beyond) to build web apps.  The sections on the first steps towards scaling your app, and extending CodeIgniter itself make this book stand out from the crowd.
</p>

        </div>
            </article>
    <nav>
        <a href="/page/129">Newer Posts</a><br />
        <a href="/page/131">Older Posts</a><br />
    </nav>
                </div>
                <div class="span4 sidebar">
                    <div class="well">
                        <h4>@TheKeyboard <small>The ramblings of a grumpy programmer</small></h4>
                    </div>
                    <div class="well sidebar-nav">
                        <h4>Links</h4>
                        <ul class="nav">
                            <li><a href="http://sculpin.io">sculpin.io</a></li>
                            <li><a href="http://twitter.com/getsculpin">@getsculpin</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <footer class="container">
            &copy; 2014 @TheKeyboard
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/components/jquery/jquery.min.js"><\/script>')</script>
        <script src="/components/bootstrap/js/bootstrap.min.js"></script>
                
                <script src="/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
