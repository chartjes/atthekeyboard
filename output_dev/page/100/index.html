<!DOCTYPE html>
<html>
    <head>
        <title>Home &mdash; @TheKeyboard &mdash; The ramblings of a grumpy programmer</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/components/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
        <link href="/css/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="stylesheet" href="/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="@TheKeyboard activity feed" />
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
        </style>
    </head>
    <body>
        <header>
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="/">@TheKeyboard</a>
                        <div class="nav-collapse collapse">
                            <ul class="nav">
                                <li><a href="/blog">Posts Archive</a></li>
                                <li><a href="/blog/categories">Categories</a></li>
                                <li><a href="/blog/tags">Tags</a></li>
                                <li><a href="/about">About</a></li>
                            </ul>
                        </div><!--/.nav-collapse -->
                    </div>
                </div>
            </div>
        </header>
        <div class="mainContent container">
            <div class="row-fluid">
                <div class="span8">
                        <article>
        <header>
            <h2><a href="/_posts/2008-12-24-chris-brain-x-mas-2008-edition.markdown"></a></h2>
        </header>
        <div>
            <hr />

<p>layout: post</p>

<h2>title: Chris' Brain, X-Mas 2008 Edition</h2>

<p>As a guy who gets so much out of open source software, I thought that this Christmas season is a good time for me to give something back to all of you out there and share with you some of the things I've been thinking about.  Notice that many of these things are not PHP related...
</p>

<h3>Rails and Merb merge</h3>

<p>Much to surprise of many, egos have been pushed aside and <a href="http://yehudakatz.com/2008/12/23/rails-and-merb-merge/">Rails and Merb are merging to create Rails 3</a>.  It's not very often I read something online and unleash a string of astonished obscenities, but this announcement absolutely stunned me.</p>

<p>
If I ever went back into the land of Ruby again, <a href="http://merbivore">Merb</a> was going to be the framework I was going to use.  But since I'm not going that way, it's really a moot point.  Rails can only get better by not only integrating stuff from Merb into it but also taking to heart the modular nature of Merb itself.
</p>

<p>
Perhaps this is yet another watershed moment in the evolution of frameworks.  As much as I am a full-stack guy, I am seeing the advantage to having a framework that has a very tight core, and lots of modules that you can add-on to it.  <a href="http://www.djangoproject.org">Django</a> has this to a certain extent, but it also has a lot in the core.
</p>

<h3>Alternate Workflows</h3>

<p>
I've been spending time at work trying to figure out workflows that fit in with my development style.  I found this very innovative <a href="http://joemaller.com/2008/11/25/a-web-focused-git-workflow/">web-focused workflow</a> that uses <a href="http://git.or.cz">Git</a>.  The thing that I find intriguing is that it allows you to make edits on the production side, and those changes get propagated to where they need to go.  Even though I think that doing edits on the production side of things is usually a Very Bad Idea, but that might be a product of my experience with one-way deployment of code from dev->staging->production.
</p>

<h3>Master your Editor</h3>

<p>
Now that my waffling is over and I only use <a href="http://code.google.com/p/macvim/">MacVim</a> as my primary editor, I am now embarking on the journey from beginning user to vim power user.  Thanks to posts like <a href="http://www.catonmat.net/blog/vim-plugins-surround-vim/">this one from a series on Vim plugins you should know about</a>, I can customize my programming environment to be the way *I* want.  No matter what editor you use, take the time to learn it's features and you will surely discover ways to become more productive.
</p>

<h3>Design your site from front to back</h3>

<p>
Ever tried to design a site based off a text description from the client / boss / whatever?  You are doomed to failure.  Instead, I have started insisting on taking things in the other direction and designing from front to back.  Tools like <a href="http://www.balsamiq.com/products/mockups">Balsamiq Mockups</a> are indispensable to make this happen.  In truth the tool doesn't matter.  What matters is that you have a way to draw rough designs for your site and then build it from the interface on back.  For a guy who has very little design talent, this makes total sense to me.  I have two side projects that currently exist ONLY as interface sketches.  And I think that is a good thing.
</p>

<p>Any way, that's it for now.  Have a good holiday season I will be posting again next week with the next installment in my "refactoring with CakePHP" series, this time about the rearranging of business logic and display logic.
</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/_posts/2008-12-27-cakephp-12-final-released-and-some-thoughts-on-frameworks.markdown"></a></h2>
        </header>
        <div>
            <hr />

<p>layout: post</p>

<h2>title: CakePHP 1.2 Final released and some thoughts on frameworks</h2>

<p>Congrats to the CakePHP dev team for getting 1.2 final out the door just in time for X-Mas.  Read all the details <a href="http://bakery.cakephp.org/articles/view/the-gift-of-1-2-final">here</a>.  I feel somewhat guilty as I have not been able to contribute to 1.2 during the run-up to the final release, but working with it for a side project has been enjoyable and living on the bleeding edge for a side project has not resulted in any show-stopping bugs.  That alone is worth mentioning.
</p>

<p>
I know that frameworks get a bad rap, especially full-stack ones like Cake, but most of those complaints come from people who are unwilling or unable to embrace the constraints on your environment that Cake places.  I used to be militant about that sort of thing, but I've come to realize that it just doesn't matter.  I'd rather shape my application to leverage the strengths of a framework.   Maybe I am just smart enough to figure out workarounds for the weaknesses.  But understanding the environment 
</p>

<p>
Terry Chay had an awesome contribution to PHP Advent 2008 where he talked about <a href="http://phpadvent.org/2008/php-without-php-by-terry-chay">some funky tricks in PHP and the importance of respecting the environment your code will run in.</a>.  After I said nice things about the post on Twitter, he sent this to me (note, this was spread across two tweets):
<blockquote>
<i>Thank you. I appreciate the comment. Happy Christmas. :-)  I know we don't always agree on things like CakePHP, so the fact that you liked the entry means a lot.</i>
</blockquote>
</p>

<p>
I was disappointed there were no f-bombs in the reply, but it's still nice to have someone you consider on another upper level of competency from you to say nice things back.</p>

<p>
Anyway, even if you hate CakePHP I think it's worth investing 5 to 10 minutes of your time to look at the announcement and see just how much stuff is in the 1.2 release and ask yourself how much of that code could you write yourself *and* have it be reusable by others.  To me, the fact that I can use much of what is in CakePHP without any modification beyond the conventions is the real reason to use it.
</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/_posts/2008-12-30-converting-legacy-apps-to-cakephp-part-3.markdown"></a></h2>
        </header>
        <div>
            <hr />

<p>layout: post
title: Converting Legacy Apps to CakePHP, Part 3
author: Chris Hartjes</p>

<h2>date: 2008-12-30</h2>

<p>I hope everyone has had a good holiday season this winter of 2008/2009.  Me, I took two weeks of consecutive vacation time for the first time since my youngest was born.  This has given me time to relax, enjoy time with my family and think about 2009.  Due to time constraints I have been forced to start the process of handing over the Side Project That Will Not End to another developer who can give it the attention that it deserves and needs.  If you are well versed in CakePHP 1.2 and are looking for a side project that will push your skills, contact me.  The client is anxious to get it done and are awesome to work with.
</p>

<p>
Anyway, onto other matters.  As you saw in parts 1 and 2, a bug part in having a successful transition from legacy app to CakePHP is having an environment that is well suited to the use of a framework.  Having laid out the groundwork for that switchover, it's time to talk about the part of a refactoring or porting that is most difficult:  separating your business logic from your display logic.
</p>

<p>
In a post on this site, I talked about the concept of "fat models and skinny controllers".  Having worked with frameworks professionally for almost two years now, I can say that I think I can update that motto to be "fat models, skinny controllers, and flexible views".   So, just what do I mean about this.
</p>

<p>
The main reason people use a framework (other than to become a raving fanboi) is to provide structure to an application.  However, with this structure there comes some limitations.   Maybe limitations is the wrong word.  I prefer to borrow a term used a lot by the Rails world (and the Cake world as well), and that is "convention".  Every framework has it's conventions, and the culture and environment of the framework dictates what the rules are for the models, views and controllers.  Or models, views and templates if you're into Django.  Whatever you call them (data source, request responder, output?) any framework does its best to try and prevent you from doing harm to yourself while coding.
</p>

<p>
In what I call spaghetti PHP, you usually end up with applications that have their data source interactions, request responder and output mashed together.  The vast majority of my early code was of this type.  Nothing wrong with it, as long as it was cleanly written and easy to understand.  Frameworks say that this kind of thing leads to poorly written code and lack of flexibility.  Refactoring spaghetti PHP is not always easy, especially when you have to add new things into the mix.
</p>

<p>
So, as a result, it has become a common programming practice to make the effort to separate your business logic from your presentation logic.  I don't think this is a bad thing at all, framework fanboi that I am or not.  The goal in all this is to create an application that is easier to maintain going forward, and I truly believe that this can only be done through this separation.  But *how* do you do this?
</p>

<p>
Let's look at the first part of the new motto:  "fat models".  Now, I'm not talking about <a href="http:://http://en.wikipedia.org/wiki/Big_Beautiful_Woman">BBW</a> here, despite how many people end up on my site via a search along those lines.  The "fat model" is the concept of placing as much code in the data source interaction parts of your application as possible.  In Cake terms, this means creating methods in your models to do all the data crunching that you need, and then having your controllers simply call these model methods and pass the results to the view.
</p>

<p>
So, in our legacy app we had a structure that used "modules", which are really nothing more than a number of <a href="http://en.wikipedia.org/wiki/Front_controller">front controllers</a> that had request response processing via large switch-case blocks that did a lot of database calls.  Then, it would do a search-and-replace of tokens within a template based on the data retrieved and then display it.  While I had some issues with their "all-inclusive templates" that controlled the display of data via CSS calls that set "display:none" as needed, it did mean I had templates to work with.  
</p>

<p>
The next logical step then was to take a look at all the database calls that were being done within these modules and map them to a particular Cake model.  As I looked at the queries and what was being done with the results, I started breaking them done into one of two categories:
<ol>
<li>Results that could be obtained with the existing model methods like find('all') etc</li>
<li>Results that would require further manipulation of the data after using an existing model method call</li>
</ol>
</p>

<p>
Initially, I thought that I would be looking at a small number of the first category, but in the end it was the power of Cake's Associative Data Mapping capabilities that made me realize the number of custom model methods would be minimal.  Let me give you some examples.
</p>

<p>
Let's say that I need to get a list of all cases that belong to a particular firm.  Here's one way of doing that in Cake.
~~~
<?php

// Given that we have a has-and-belongs-to-many relationship 
// established between LegalCase and Firm, and the ID of the firm 
// already stored in the session via the Auth component

$conditions = array(
     'LegalCase.archived' => 0,
     'Firm.id' => $this->Auth->user('firm_id')
);
$order = 'LegalCase.case_name';
$cases = $this->LegalCase->CaseFirm->find('all', compact('conditions', 'order'));

?>
~~~
</p>

<p>
Very straightforward, and Cake would return to me an associative array containing all the cases that belong to the firm, ready to pass to the view.  If you were to look at the SQL generated by such a thing, you would see that it was using some SQL JOINS to link the cases, firms and cases_firms table to get my results.  I cannot recommend enough for people building things in CakePHP to use the awesome <a href="http://github.com/cakephp/debug_kit/tree/master">Debug Kit</a> to peer inside Cake as you develop.
</p>

<p>
In another part of the application, I had to get a list of orders that had been archived, count them, and group them by month.  Obviously this could not be done with just the existing model methods.  So I looked at the queries and then the code that followed those queries, then condensed them down into a method in the Order model:<br />
~~~
    function archivedOrdersCount($user_id) {
        $fields = "DATE_FORMAT(date_completed, '%m') as month_completed, DATE_FORMAT(date_completed, '%M') as month_name, DATE_FORMAT(date_completed, '%Y') as year_completed";
        $conditions = array(
            'user_id' => $user_id,
            'OR' => array(
                'client_archive' => 1,
                'void' => 1)
        );
        $order = "year_completed, month_completed ASC";
        $results = $this->find('all', compact('fields', 'conditions', 'order'));
        $orders = array();

        foreach ($results as $result) {
            $key = "{$result[0]['month_name']} {$result[0]['year_completed']}";
            
            if (!isset($orders[$key])) {
                $orders[$key] = array(
                    'year' => $result[0]['year_completed'],
                    'month' => $result[0]['month_completed'],
                    'label' => $key,
                    'count' => 0
                );
            }

            $orders[$key]['count']++;
        }   
        
        return $orders; 
    }
~~~
</p>

<p>
I think part of the problem a lot of people are faced with when converting a legacy app over to using *any* framework, is the idea that your problems are unique and not solvable via a framework.  In the context of using Cake's models, I think people would be really shocked to discover just how easy it really is now to take an existing query and make it work with Cake models.
</p>

<p>
I hope I've given you a little glimpse into some of the work involved in converting SQL calls in PHP over to using Cake's model objects.  In the next post in this series, I'll be showing what I mean by "skinny controllers".
</p>

        </div>
            </article>
    <nav>
        <a href="/page/99">Newer Posts</a><br />
        <a href="/page/101">Older Posts</a><br />
    </nav>
                </div>
                <div class="span4 sidebar">
                    <div class="well">
                        <h4>@TheKeyboard <small>The ramblings of a grumpy programmer</small></h4>
                    </div>
                    <div class="well sidebar-nav">
                        <h4>Links</h4>
                        <ul class="nav">
                            <li><a href="http://sculpin.io">sculpin.io</a></li>
                            <li><a href="http://twitter.com/getsculpin">@getsculpin</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <footer class="container">
            &copy; 2014 @TheKeyboard
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/components/jquery/jquery.min.js"><\/script>')</script>
        <script src="/components/bootstrap/js/bootstrap.min.js"></script>
                
                <script src="/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
