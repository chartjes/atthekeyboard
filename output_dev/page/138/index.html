<!DOCTYPE html>
<html>
    <head>
        <title>Home &mdash; @TheKeyboard &mdash; The ramblings of a grumpy programmer</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/components/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
        <link href="/css/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="stylesheet" href="/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="@TheKeyboard activity feed" />
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
        </style>
    </head>
    <body>
        <header>
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="/">@TheKeyboard</a>
                        <div class="nav-collapse collapse">
                            <ul class="nav">
                                <li><a href="/blog">Posts Archive</a></li>
                                <li><a href="/blog/categories">Categories</a></li>
                                <li><a href="/blog/tags">Tags</a></li>
                                <li><a href="/about">About</a></li>
                            </ul>
                        </div><!--/.nav-collapse -->
                    </div>
                </div>
            </div>
        </header>
        <div class="mainContent container">
            <div class="row-fluid">
                <div class="span8">
                        <article>
        <header>
            <h2><a href="/blog/8400/11/25/metatesting-testing-constructors">Metatesting: Testing Constructors</a></h2>
        </header>
        <div>
            <p>If you have a PHP application that makes heavy use of objects (which is probably
95% of you reading this) then you will have objects with constructor methods
in them. It is also very likely that there is some stuff going on in those
constructors. So how do you test things like this?</p>

<p>Here is the constructor method that we are trying to test:</p>

<pre><code>&lt;?php

class Alpha
{
    protected $_foo;
    protected $_bar;
    protected $_baz;

    public function __construct()
    {
        $container = Grumpy_Container::getInstance();
        $alphaConfig = $container-&gt;alphaConfig();
        $this-&gt;_foo = $alphaConfig-&gt;foo;
        $this-&gt;_bar = $alphaConfig-&gt;bar;
        $this-&gt;_baz = $alphaConfig-&gt;baz;
    }

    // the rest of our class is here
}
</code></pre>

<p>In this example, Grumpy&#95;Container is an object that is available via
autoloading and it is used as a dependency injection container (DIC).</p>

<p>Okay, so how do we test that the constructor is doing what it is supposed to?
We would want to verify that those protected class attributes have been set
to values we are expecting.</p>

<p>In order to do that we will also need to override the values in our DIC so 
when we run the test we have values in there we are expecting.</p>

<pre><code>&lt;?php

public testConstructorAssignsExpectedAttributeValues()
{
    $container = Grumpy_Container::getInstance();

    // Create our mock configuration object
    $alphaConfig = new stdClass();
    $alphaConfig-&gt;foo = 'testfoo';
    $alphaConfig-&gt;bar = 'testbar';
    $alphaConfig-&gt;baz = 'testbaz';

    // Place this back in the container to override what we have
    $container-&gt;alphaConfig = function() use ($alphaConfig) {
        return $alphaConfig;
    };

    // Create our mock object
    $alphaTest = $this-&gt;getMockBuilder('Alpha')
        -&gt;disableOriginalConstructor()
        -&gt;getMock();

    // Manually run the constructor
    $alphaTest-&gt;__construct();

    // Check for values we expect
    $this-&gt;assertAttributeEquals(
        $alphaConfig-&gt;foo,
        '_foo',
        $alphaTest,
        'Should set expected foo config value'
    );

    $this-&gt;assertAttributeEquals(
        $alphaConfig-&gt;bar,
        '_bar',
        $alphaTest,
        'Should set expected foo config value'
    );

    $this-&gt;assertAttributeEquals(
        $alphaConfig-&gt;baz,
        '_baz',
        $alphaTest,
        'Should set expected bar config value'
    );

}

</code></pre>

<p>The magic method here is assertAttributeEquals(). It lets you check the value
inside any protected or private class attributes, which is absolutely a 
requirement in this example. It is probably better to have some other
publicly-available methods that can return us the protected (or in some
cases private because you don't want anyone to manipulate them) attributes.</p>

<p>Hope this helps you understand some ways to test your constructors.</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/blog/8000/11/25/renovating-sucks">Renovating Sucks</a></h2>
        </header>
        <div>
            <p>My apologies for the big mess here. As some of you who follow me on twitter might
be away, I accidentally blew away all the source for this blog while trying to fix
a syntax highlighting problem with some older posts. I thought I had a back-up of
the source on my external drive but it turns out that I was not telling it to
back up my home directory, for whatever reason. How awkward.</p>

<p>Luckily I sill had the dump of data from my old WordPress blog in a database so
since I was still going to use Jekyll, I used one of the provided converters and
got back to work. I was still missing 13 posts though. Those were fairly easy to
recover thanks to the awesomeness that is <a href="https://github.com/jgm/pandoc">Pandoc</a>. What is
Pandoc? It bills itself as a "universal file converter" and it does a pretty
good job. I used it to convert those old posts in HTML format into Markdown. Now that I had
all my posts (stretching back to October of 2005) it was time to renovate.</p>

<p>I'm not using just Jekyll. I decided to use <a href="http://octopress.org">Octopress</a>, which
is a suite of tools written in Ruby that sit on top of Jekyll. I edit my posts in Markdown 
as usual, and then it's "rake generate &amp;&amp; rake deploy" to make new posts. Of course, it 
wasn't quite that simple but that is the basic version of it.</p>

<p>(Edit: I previously had said I was going to drop comments from the blog but because I kept the same URL structure, the Disqus plugin
for Octopress was able to easily find them. Another small victory for Octopress)</p>

<p>Finally I apologize to people who are reading my feed if I have just blasted them with 800+ posts
due to me setting the blog up again.</p>

<p>Anyway, I'm back and expect the info to start flowing again.</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/blog/6800/11/25/tricorder-a-testing-helper-for-php">Tricorder: a testing helper for PHP</a></h2>
        </header>
        <div>
            <p>I've hacked together a little CLI script that I think will be of use to many
people who are trying to answer the question "just what should I do to test
this thing anyway?" as they learn how to write PHPUnit tests to go along with
their code.</p>

<p>While I as at php|tek 2012 I had a conversation with <a href="https://twitter.com/DragonBe">Michelangelo van Dam</a>
about an idea I had for a testing tool: something that could look at your code
and give you suggestions on what you should be testing. In no time flat he
hooked me up with one of the core guys on the <a href="http://phpdoc.org">phpDocumentor</a> project,
<a href="https://twitter.com/mvriel">Mike van Riel</a> and in the course of one short Skype
chat I knew I had the right tools for the job.</p>

<p>I've created something that I am calling <a href="https://github.com/chartjes/php-tricorder/">PHP-Tricorder</a>, a CLI
utility that can be used in conjunction with phpdoc structure.xml files to make
suggestions on testing scenarios. It's at a 0.1 release right now, so I anticipate
it will grow and add more features as time goes on. I'd like to think right now
that it's pretty useful for people who are just beginning down the road of
writing tests for their code.</p>

<p>Here's some sample output from a run of PHP-Tricorder:</p>

<pre><code>chartjes@php-vm:~/php-tricorder$ php tricorder.php ../building-testable-applications/lib/IBL/structure.xml 
Reading in phpDocumentor structure file...

FranchiseMapper.php

Scanning FranchiseMapper

__construct -- make sure to mock $conn as \PDO

createFranchiseFromRow -- make sure to test $row using an empty array()

delete -- make sure to mock $franchise as \IBL\Franchise

findAll -- make sure to test method returns \IBL\Franchise instances
findByConference -- make sure to test $conference using null or empty strings

findByConferenceDivision -- make sure to test $conference using null or empty strings

findByNickname -- make sure to test $nickname using null or empty strings

findById -- make sure to test $id using non-integer values

generateMap -- make sure to test $teamsTable using null or empty strings

save -- make sure to mock $franchise as \IBL\Franchise

_insert -- non-public methods are difficult to test in isolation
_insert -- make sure to mock $franchise as \IBL\Franchise

_update -- non-public methods are difficult to test in isolation
_update -- make sure to mock $franchise as \IBL\Franchise
</code></pre>

<p>So check the project out on Github, pull requests and patches are welcome
and I look forward to building this tool out to meet the needs of other
PHP developers.</p>

        </div>
            </article>
    <nav>
        <a href="/page/137">Newer Posts</a><br />
        <a href="/page/139">Older Posts</a><br />
    </nav>
                </div>
                <div class="span4 sidebar">
                    <div class="well">
                        <h4>@TheKeyboard <small>The ramblings of a grumpy programmer</small></h4>
                    </div>
                    <div class="well sidebar-nav">
                        <h4>Links</h4>
                        <ul class="nav">
                            <li><a href="http://sculpin.io">sculpin.io</a></li>
                            <li><a href="http://twitter.com/getsculpin">@getsculpin</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <footer class="container">
            &copy; 2014 @TheKeyboard
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/components/jquery/jquery.min.js"><\/script>')</script>
        <script src="/components/bootstrap/js/bootstrap.min.js"></script>
                
                <script src="/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
