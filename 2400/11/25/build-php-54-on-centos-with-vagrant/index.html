<!DOCTYPE html>
<html>
    <head>
        <title>Build PHP 5.4 on CentOS with Vagrant &mdash; @TheKeyboard &mdash; The ramblings of a grumpy programmer</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="http://littlehart.net/atthekeyboard/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="http://littlehart.net/atthekeyboard/components/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
        <link href="http://littlehart.net/atthekeyboard/css/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="stylesheet" href="http://littlehart.net/atthekeyboard/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="http://littlehart.net/atthekeyboard/atom.xml" title="@TheKeyboard activity feed" />
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
        </style>
    </head>
    <body>
        <header>
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="http://littlehart.net/atthekeyboard/">@TheKeyboard</a>
                        <div class="nav-collapse collapse">
                            <ul class="nav">
                                <li><a href="http://littlehart.net/atthekeyboard/blog">Posts Archive</a></li>
                                <li><a href="http://littlehart.net/atthekeyboard/blog/categories">Categories</a></li>
                                <li><a href="http://littlehart.net/atthekeyboard/blog/tags">Tags</a></li>
                                <li><a href="http://littlehart.net/atthekeyboard/about">About</a></li>
                                <li><a href="http://littlehart.net/atthekeyboard/atom.xml">RSS/Atom</a></li>
                            </ul>
                        </div><!--/.nav-collapse -->
                    </div>
                </div>
            </div>
        </header>
        <div class="mainContent container">
            <div class="row-fluid">
                <div class="span8">
                        <article>
        <header>
            <h2>Build PHP 5.4 on CentOS with Vagrant <small>post</small></h2>
        </header>
        <div>
            <p>I like the idea of using <a href="http://vagrantup.com">Vagrant</a> to create virtual
machines for my development work. Doing things this way I think keeps the
host machine cleaner and allows you the ability to distribute those VM's
to other people as well.</p>

<p>My old boss Ben Ramsey did a very informative post on <a href="http://benramsey.com/blog/2012/03/build-php-54-on-centos-62/">getting PHP 5.4 configured on CentOS</a>
so I decided to one-up him by taking his instructions and creating a <a href="http://puppetlabs.com/">Puppet</a>
manifest so you could do this using Vagrant or on any server that you can 
provision using Puppet.</p>

<p>First, you will need a CentOS base box to play with. I used <a href="http://www.vagrantbox.es/37/">this box</a>
but I think any CentOS 6.0 (or above) base box will do. If you are feeling really
adventurous you could grab an ISO and use <a href="https://github.com/jedi4ever/veewee">Vewee</a> 
and follow <a href="http://www.ducea.com/2011/08/15/building-vagrant-boxes-with-veewee/">these instructions</a>
to create your own.</p>

<p>Whatever box you choose, the next step is to create the directory where your VM
will run and run 'vagrant init' with the name of the box and then edit the Vagrantfile.
Here's a condensed version of my Vagrantfile</p>

<pre><code>Vagrant::Config.run do |config|
  config.vm.box = "centos-60-x86_64"

  config.vm.forward_port 80, 8080
  config.vm.forward_port 8000, 8000

  config.vm.provision :puppet do |puppet|
     puppet.manifests_path = "manifests"
     puppet.manifest_file  = "default.pp"
  end
end
</code></pre>

<p>Those port forwards are identical to the ones that Ben suggested using. You
can get rid of the one that maps port 8000 if you don't feel like playing
around with the new built-in web server introducted in PHP 5.4.</p>

<p>Now, create the manifests directory inside the directory where you are placing
the new VM and add a file called default.pp that looks like this:</p>

<pre><code># Puppet manifest for my PHP dev machine

class httpd {
  exec { 'yum-update':
    command =&gt; '/usr/bin/yum -y update'
  }

  package { "httpd":
    ensure =&gt; present,
  }

  package { "httpd-devel":
    ensure  =&gt; present,
  }
}

class phpdev {
  package { "libxml2-devel":
    ensure  =&gt; present,
  }


  package { "libXpm-devel":
    ensure  =&gt; present,
  }

  package { "gmp-devel":
    ensure  =&gt; present,
  }

  package { "libicu-devel":
    ensure  =&gt; present,
  }

  package { "t1lib-devel":
    ensure  =&gt; present,
  }

  package { "aspell-devel":
    ensure  =&gt; present,
  }

  package { "openssl-devel":
    ensure  =&gt; present,
  }

  package { "bzip2-devel":
    ensure  =&gt; present,
  }

  package { "libcurl-devel":
    ensure  =&gt; present,
  }

  package { "libjpeg-devel":
    ensure  =&gt; present,
  }

  package { "libvpx-devel":
    ensure  =&gt; present,
  }

  package { "libpng-devel":
    ensure  =&gt; present,
  }

  package { "freetype-devel":
    ensure  =&gt; present,
  }

  package { "readline-devel":
    ensure  =&gt; present,
  }

  package { "libtidy-devel":
    ensure  =&gt; present,
  }

  package { "libxslt-devel":
    ensure  =&gt; present,
  }
}

class rpmforge {
  exec {
    "/usr/bin/wget http://packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm":
      alias   =&gt; "grab-rpmforge",
  }

  exec {
    "/bin/rpm --import http://apt.sw.be/RPM-GPG-KEY.dag.txt":
      alias   =&gt; "import-key",
      require =&gt; Exec["grab-rpmforge"],
  }

  exec {
    "/bin/rpm -i rpmforge-release-0.5.2-2.el6.rf.*.rpm":
      alias   =&gt; "install-rpmforge",
      require =&gt; Exec["import-key"],
  }

  package { "libmcrypt-devel":
    ensure  =&gt; present,
    require =&gt; Exec["install-rpmforge"]
  }
}

include httpd
include phpdev
include rpmforge

</code></pre>

<p>Now, there <em>appears</em> to be a lot of stuff going on in there, but it's actually
quite simple. I broke things down into 3 distinct groups.</p>

<p>The first group (
which I called 'httpd') makes sure that we install Apache 2 and the development
libraries and header files that will be needed to compile PHP. Then we open up
the firewall to allow access to the VM on those two ports. By default Vagrant
maps port 22 on the VM to port 2222 on the VM, so no need to add that in.</p>

<p>The next group (phpdev) is installing all the support libraries that Ben recommended 
in his own article.</p>

<p>Finally we need to execute a few commands to allows us to also install libmcrypt-devel
because it is not part of the standard CentOS distribution, but is available via
RPMForge.</p>

<p>Save that file (make sure there are no typos either from me or from you!), then type
'vagrant up' and it will try and it will try to provision your new server with this
Puppet manifest and add in all your files.</p>

<p>Then you can follow the rest of Ben's instructions on how to compile PHP 5.4 (I
installed PHP 5.4.1RC1 just to be living on the edge) and don't forget to verify
that your Apache setup is configured to all you to serve up PHP files.</p>

<p>I think that you can have a cutting-edge CentOS VM with the latest PHP installed on
it up and running in under an hour from starting to download your CentOS Vagrant
base box to verifying your test file with phpinfo() in it worked.</p>

        </div>
                
                    <nav class="article">
                <ul>
                                            <li>Next: <a class="next" href="http://littlehart.net/atthekeyboard/2800/11/25/phpspec-and-the-new-wave-of-testing" title="PHPSpec and the new wave of testing"><span class="title">PHPSpec and the new wave of testing</span></a></li>
                                                                <li>Previous: <a class="previous" href="http://littlehart.net/atthekeyboard/2014/10/31/web-acceptance-tools-suck" title="Web Acceptance Tools Suck"><span class="title">Web Acceptance Tools Suck</span></a></li>
                                    </ul>
            </nav>
            </article>
                </div>
                <div class="span4 sidebar">
                    <div class="well">
                        <h4>@TheKeyboard <small>The ramblings of a grumpy programmer</small></h4>
                    </div>
                    <div class="well sidebar-nav">
                        <section>
                            <img src="http://www.littlehart.net/DRAW-ANYTHING-363.gif" alt="A bald-headed, goateed man smashing his laptop with a baseball bat">
                        </section>
                        <section>
                            <h1>Books</h1>
                            <p>
                            Using PHPUnit doesn&#8217;t have to suck. Learn how to master this powerful testing
                            framework through my book <a href="http://www.grumpy-phpunit.com">The Grumpy Programmer&#8217;s PHPUnit Cookbook</a>
                            </p>
                            <p>
                            Interested in learning more about testing your PHP applications? My latest book
                            <a href="http://www.grumpy-testing.com">&#8220;The Grumpy Programmer&#8217;s Guide To Buliding Testable Applications In PHP&#8221;</a> 
                            is now available in PDF/epub/mobi and paperback.
                            </p>
                            <h1>Videos</h1>
                            <p>
                            It&#8217;s the next best thing to me teaching you one-on-one how to become better at testing your code!
                            The &#8220;PHP Bootcamp Sessions&#8221; Videos are now available at <a href="http://grumpy-learning.com">Grumpy Learning</a>.
                            3+ hours of instruction in DRM-free 640x480 MP4 for just $99.
                            </p>
                        </section>
                            <section>
                            <a href="http://stackexchange.com/users/31743">
                            <img src="http://stackexchange.com/users/flair/31743.png" width="208" height="58" alt="profile for GrumpyCanuck on Stack Exchange, a network of free, community-driven Q&amp;A sites" title="profile for GrumpyCanuck on Stack Exchange, a network of free, community-driven Q&amp;A sites">
                            </a>
                        </section>
                        <section>
                            <h1>Development Hell</h1>
                            <p>
                            Check out the <a href="http://devhell.info">podcast</a> I do with <a href="http://funkatron.com">Ed Finkler</a>
                            where we do a free-flowing, unedited talk about various programming topics.
                            </p>
                        </section>
                    </div>
                </div>
            </div>
        </div>
        <footer class="container">
            &copy; 2014 @TheKeyboard
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="http://littlehart.net/atthekeyboard/components/jquery/jquery.min.js"><\/script>')</script>
        <script src="http://littlehart.net/atthekeyboard/components/bootstrap/js/bootstrap.min.js"></script>
                
                <script src="http://littlehart.net/atthekeyboard/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
