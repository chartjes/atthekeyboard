<!DOCTYPE html>
<html>
    <head>
        <title>Metatesting: Testing Constructors &mdash; @TheKeyboard &mdash; The ramblings of a grumpy programmer</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="http://littlehart.net/atthekeyboard/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="http://littlehart.net/atthekeyboard/components/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
        <link href="http://littlehart.net/atthekeyboard/css/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="stylesheet" href="http://littlehart.net/atthekeyboard/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="http://littlehart.net/atthekeyboard/atom.xml" title="@TheKeyboard activity feed" />
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
        </style>
    </head>
    <body>
        <header>
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="http://littlehart.net/atthekeyboard/">@TheKeyboard</a>
                        <div class="nav-collapse collapse">
                            <ul class="nav">
                                <li><a href="http://littlehart.net/atthekeyboard/blog">Posts Archive</a></li>
                                <li><a href="http://littlehart.net/atthekeyboard/blog/categories">Categories</a></li>
                                <li><a href="http://littlehart.net/atthekeyboard/blog/tags">Tags</a></li>
                                <li><a href="http://littlehart.net/atthekeyboard/about">About</a></li>
                                <li><a href="http://littlehart.net/atthekeyboard/atom.xml">RSS/Atom</a></li>
                            </ul>
                        </div><!--/.nav-collapse -->
                    </div>
                </div>
            </div>
        </header>
        <div class="mainContent container">
            <div class="row-fluid">
                <div class="span8">
                    <p>If you have a PHP application that makes heavy use of objects (which is probably
95% of you reading this) then you will have objects with constructor methods
in them. It is also very likely that there is some stuff going on in those
constructors. So how do you test things like this?</p>

<p>Here is the constructor method that we are trying to test:</p>

<pre><code>&lt;?php

class Alpha
{
    protected $_foo;
    protected $_bar;
    protected $_baz;

    public function __construct()
    {
        $container = Grumpy_Container::getInstance();
        $alphaConfig = $container-&gt;alphaConfig();
        $this-&gt;_foo = $alphaConfig-&gt;foo;
        $this-&gt;_bar = $alphaConfig-&gt;bar;
        $this-&gt;_baz = $alphaConfig-&gt;baz;
    }

    // the rest of our class is here
}
</code></pre>

<p>In this example, Grumpy&#95;Container is an object that is available via
autoloading and it is used as a dependency injection container (DIC).</p>

<p>Okay, so how do we test that the constructor is doing what it is supposed to?
We would want to verify that those protected class attributes have been set
to values we are expecting.</p>

<p>In order to do that we will also need to override the values in our DIC so 
when we run the test we have values in there we are expecting.</p>

<pre><code>&lt;?php

public testConstructorAssignsExpectedAttributeValues()
{
    $container = Grumpy_Container::getInstance();

    // Create our mock configuration object
    $alphaConfig = new stdClass();
    $alphaConfig-&gt;foo = 'testfoo';
    $alphaConfig-&gt;bar = 'testbar';
    $alphaConfig-&gt;baz = 'testbaz';

    // Place this back in the container to override what we have
    $container-&gt;alphaConfig = function() use ($alphaConfig) {
        return $alphaConfig;
    };

    // Create our mock object
    $alphaTest = $this-&gt;getMockBuilder('Alpha')
        -&gt;disableOriginalConstructor()
        -&gt;getMock();

    // Manually run the constructor
    $alphaTest-&gt;__construct();

    // Check for values we expect
    $this-&gt;assertAttributeEquals(
        $alphaConfig-&gt;foo,
        '_foo',
        $alphaTest,
        'Should set expected foo config value'
    );

    $this-&gt;assertAttributeEquals(
        $alphaConfig-&gt;bar,
        '_bar',
        $alphaTest,
        'Should set expected foo config value'
    );

    $this-&gt;assertAttributeEquals(
        $alphaConfig-&gt;baz,
        '_baz',
        $alphaTest,
        'Should set expected bar config value'
    );

}

</code></pre>

<p>The magic method here is assertAttributeEquals(). It lets you check the value
inside any protected or private class attributes, which is absolutely a 
requirement in this example. It is probably better to have some other
publicly-available methods that can return us the protected (or in some
cases private because you don't want anyone to manipulate them) attributes.</p>

<p>Hope this helps you understand some ways to test your constructors.</p>
                </div>
                <div class="span4 sidebar">
                    <div class="well">
                        <h4>@TheKeyboard <small>The ramblings of a grumpy programmer</small></h4>
                    </div>
                    <div class="well sidebar-nav">
                        <section>
                            <img src="http://www.littlehart.net/DRAW-ANYTHING-363.gif" alt="A bald-headed, goateed man smashing his laptop with a baseball bat">
                        </section>
                        <section>
                            <h1>Books</h1>
                            <p>
                            Using PHPUnit doesn&#8217;t have to suck. Learn how to master this powerful testing
                            framework through my book <a href="http://www.grumpy-phpunit.com">The Grumpy Programmer&#8217;s PHPUnit Cookbook</a>
                            </p>
                            <p>
                            Interested in learning more about testing your PHP applications? My latest book
                            <a href="http://www.grumpy-testing.com">&#8220;The Grumpy Programmer&#8217;s Guide To Buliding Testable Applications In PHP&#8221;</a> 
                            is now available in PDF/epub/mobi and paperback.
                            </p>
                            <h1>Videos</h1>
                            <p>
                            It&#8217;s the next best thing to me teaching you one-on-one how to become better at testing your code!
                            The &#8220;PHP Bootcamp Sessions&#8221; Videos are now available at <a href="http://grumpy-learning.com">Grumpy Learning</a>.
                            3+ hours of instruction in DRM-free 640x480 MP4 for just $99.
                            </p>
                        </section>
                            <section>
                            <a href="http://stackexchange.com/users/31743">
                            <img src="http://stackexchange.com/users/flair/31743.png" width="208" height="58" alt="profile for GrumpyCanuck on Stack Exchange, a network of free, community-driven Q&amp;A sites" title="profile for GrumpyCanuck on Stack Exchange, a network of free, community-driven Q&amp;A sites">
                            </a>
                        </section>
                        <section>
                            <h1>Development Hell</h1>
                            <p>
                            Check out the <a href="http://devhell.info">podcast</a> I do with <a href="http://funkatron.com">Ed Finkler</a>
                            where we do a free-flowing, unedited talk about various programming topics.
                            </p>
                        </section>
                    </div>
                </div>
            </div>
        </div>
        <footer class="container">
            &copy; 2014 @TheKeyboard
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="http://littlehart.net/atthekeyboard/components/jquery/jquery.min.js"><\/script>')</script>
        <script src="http://littlehart.net/atthekeyboard/components/bootstrap/js/bootstrap.min.js"></script>
                
                <script src="http://littlehart.net/atthekeyboard/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
